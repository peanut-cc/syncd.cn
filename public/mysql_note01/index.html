<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>mysql笔记--基础知识 | FAN&#39;S BLOG</title>
        <meta name="Description" content="syncd blog, 在成为高级开发者的路上....."><meta property="og:title" content="mysql笔记--基础知识" />
<meta property="og:description" content="SQL基础 SQL语句的分类： DQL: 数据库查询语句，基本的就是select查询命令，用于查询数据 DML: 数据操纵语句，用于插入，更新，删除数据，即INS" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/mysql_note01/" />
<meta property="article:published_time" content="2020-09-29T19:40:56+08:00" />
<meta property="article:modified_time" content="2020-09-29T19:40:56+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="mysql笔记--基础知识"/>
<meta name="twitter:description" content="SQL基础 SQL语句的分类： DQL: 数据库查询语句，基本的就是select查询命令，用于查询数据 DML: 数据操纵语句，用于插入，更新，删除数据，即INS"/>
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-TileColor" content="#da532c">
<link rel="canonical" href="http://example.org/mysql_note01/" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="prev" href="http://example.org/protocol_analysis_01/" /><link rel="next" href="http://example.org/redis_note1/" /><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/css/style.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "mysql笔记--基础知识",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/mysql_note01\/"
        },"image": {
                "@type": "ImageObject",
                "url": "http:\/\/example.org\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "mysql","wordcount":  11762 ,
        "url": "http:\/\/example.org\/mysql_note01\/","datePublished": "2020-09-29","dateModified": "2020-09-29","publisher": {
                "@type": "Organization",
                "name": "赵凡",
                "logo": {
                "@type": "ImageObject",
                "url": "http:\/\/example.org\/logo.png",
                "width":  127 ,
                "height":  40 
                }
            },"author": {
                "@type": "Person",
                "name": "fan"
            },"description": ""
    }
    </script></head>
    <body><script>
            if (!window.localStorage || !window.localStorage.getItem('theme')) {window.isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;} else {
                window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            }
            window.isDark && document.body.classList.add('dark-theme');
        </script><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/">FAN&#39;S BLOG</a>
        </div>
        <div class="menu"><a class="menu-item" href="/posts/" rel="noopener noreffer">文章</a><a class="menu-item" href="/tags/" rel="noopener noreffer">标签</a><a class="menu-item" href="/categories/" rel="noopener noreffer">分类</a><a class="menu-item" href="/about/" rel="noopener noreffer">关于</a><span class="menu-item">|</span>
            <a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-wrapper">
        <div class="header-container">
            <div class="header-title">
                <a href="/">FAN&#39;S BLOG</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="" rel="noopener noreffer">文章</a><a class="menu-item" href="/tags/" title="" rel="noopener noreffer">标签</a><a class="menu-item" href="/categories/" title="" rel="noopener noreffer">分类</a><a class="menu-item" href="/about/" title="" rel="noopener noreffer">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>

<script>
    window.desktopHeaderMode = "fixed";
    window.mobileHeaderMode = "auto";
</script>
<main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animated flipInX">mysql笔记--基础知识</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="http://syncd.cn" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>fan</a>
</span>&nbsp;
                    <span class="post-category">收录于<a href="/categories/mysql">
                                <i class="far fa-folder fa-fw"></i>Mysql
                            </a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2020-09-29>2020-09-29</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>约 11762 字&nbsp;
                <i class="far fa-clock fa-fw"></i>预计阅读 24 分钟&nbsp;</div>
        </div><div class="toc" id="toc-auto">
                <h2 class="toc-title">目录</h2>
                <div class="toc-content" id="toc-content-auto"></div>
            </div>
            <div class="toc" id="toc-static">
                <details>
                    <summary>
                        <div class="toc-title">
                            <span>目录</span>
                            <span><i class="details icon fas fa-angle-down"></i></span>
                        </div>
                    </summary>
                    <div class="toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#sql基础">SQL基础</a></li>
    <li><a href="#约束">约束</a>
      <ul>
        <li><a href="#非空约束-not-null">非空约束 not null</a></li>
        <li><a href="#唯一约束-unique">唯一约束 unique</a></li>
        <li><a href="#主键约束-primary-key">主键约束 primary key</a>
          <ul>
            <li><a href="#自动增长-auto_increment">自动增长 auto_increment</a></li>
          </ul>
        </li>
        <li><a href="#外键约束-foreign-key">外键约束 foreign key</a>
          <ul>
            <li><a href="#什么是外键">什么是外键？</a></li>
            <li><a href="#外键的级联操作">外键的级联操作</a></li>
          </ul>
        </li>
        <li><a href="#约束小结">约束小结</a></li>
      </ul>
    </li>
    <li><a href="#数据库的设计">数据库的设计</a>
      <ul>
        <li><a href="#多表之间的关系">多表之间的关系</a>
          <ul>
            <li><a href="#分类">分类</a></li>
            <li><a href="#实现关系">实现关系</a></li>
            <li><a href="#实际案例">实际案例</a></li>
            <li><a href="#表与表关系小结">表与表关系小结</a></li>
          </ul>
        </li>
        <li><a href="#数据库设计的范式">数据库设计的范式</a>
          <ul>
            <li><a href="#案例">案例</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#多表查询">多表查询</a>
      <ul>
        <li><a href="#基础数据">基础数据</a></li>
      </ul>
    </li>
    <li><a href="#多表查询-1">多表查询</a>
      <ul>
        <li><a href="#内连接查询">内连接查询</a>
          <ul>
            <li><a href="#隐式内连接">隐式内连接</a></li>
            <li><a href="#显式内连接">显式内连接</a></li>
          </ul>
        </li>
        <li><a href="#外连接查询">外连接查询</a>
          <ul>
            <li><a href="#左外连接">左外连接</a></li>
            <li><a href="#右外连接">右外连接</a></li>
          </ul>
        </li>
        <li><a href="#子查询">子查询</a>
          <ul>
            <li><a href="#子查询的结果是单行单列">子查询的结果是单行单列</a></li>
            <li><a href="#子查寻的结果是多行单列">子查寻的结果是多行单列</a></li>
            <li><a href="#子查询的结果是多行多列的">子查询的结果是多行多列的</a></li>
          </ul>
        </li>
        <li><a href="#多表查询练习">多表查询练习</a></li>
      </ul>
    </li>
    <li><a href="#事务">事务</a>
      <ul>
        <li><a href="#事务的基本介绍">事务的基本介绍</a></li>
        <li><a href="#事务的四大特征">事务的四大特征</a></li>
        <li><a href="#事务的隔离级别">事务的隔离级别</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
                </details>
            </div><div class="content" id="content"><h2 id="sql基础">SQL基础</h2>
<p>SQL语句的分类：</p>
<ul>
<li>DQL: 数据库查询语句，基本的就是select查询命令，用于查询数据</li>
<li>DML: 数据操纵语句，用于插入，更新，删除数据，即INSERT, UPDATE,DELETE</li>
<li>DDL: 数据定义语句，用于创建，删除，以及修改表，索引等数据库对象,CREATE,DRIO,ALTER</li>
</ul>
<p>创建表：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="k">table_name</span> <span class="p">(</span>
	<span class="n">col01_name</span> <span class="n">data_type</span><span class="p">,</span>
	<span class="n">col02_name</span> <span class="n">data_type</span><span class="p">,</span>
	<span class="n">col03_name</span> <span class="n">data_type</span><span class="p">,</span>
	<span class="p">....</span>
<span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><p>关于data_type, 常用的有以下数据类型：</p>
<p>整数：</p>
<ol>
<li>
<p>tinyint: 微整数：很小的整数占8位二进制</p>
</li>
<li>
<p>smallint: 小整数： 小的整数 占16位二进制</p>
</li>
<li>
<p>mediumint: 中整数：中等长度的整数，占24位二进制</p>
</li>
<li>
<p>int: 整型，整数类型，占32位二进制</p>
</li>
</ol>
<p>小数</p>
<ol>
<li>float:单精度浮点数，占4个字节</li>
<li>double:双精度，占8个字节</li>
</ol>
<p>日期</p>
<ol>
<li>time : 表示时间类型</li>
<li>date: 表示日期类型 (只包含年月日 yyyy-MM-dd)</li>
<li>datetime: 同时可以表示日期和时间类型(包含年月日十分秒，yyyy-MM-dd HH:mm:ss)</li>
<li>timestamp: 时间戳类型，(包含年月日十分秒，yyyy-MM-dd HH:mm:ss)，如果添加数据时没有赋值，则自动插入当前的系统时间</li>
</ol>
<p>字符串</p>
<ol>
<li>
<p>char(m): 固定长度的字符串，使用几个字符就占用几个，M 为 0~65535 之间的整数</p>
</li>
<li>
<p>varchar(m):可变长度的字符串，使用几个字符就占用几个，M 为 0~65535 之间的整数</p>
</li>
</ol>
<p>大二进制</p>
<ol>
<li>tinyblob: 允许长度0-255字节</li>
<li>blog: 允许长度为0-65535字节</li>
<li>longblog: 允许长度为0~4294967295 字节</li>
</ol>
<p>大文本</p>
<pre><code>  1. tinytext: 允许长度 0~255 字节
  2. text: 允许长度 0~65535 字节
  3. mediumtext: 允许长度 0~167772150 字节
  4. longtext: 允许长度 0~4294967295 字节
</code></pre>
<p>一个简单的例子：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">create</span> <span class="k">table</span> <span class="n">student</span> <span class="p">(</span>
    <span class="o">-&gt;</span> <span class="n">id</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">-&gt;</span> <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
    <span class="o">-&gt;</span> <span class="n">age</span> <span class="nb">int</span><span class="p">,</span>
    <span class="o">-&gt;</span> <span class="n">score</span> <span class="n">double</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="o">-&gt;</span> <span class="n">birthday</span> <span class="nb">date</span><span class="p">,</span>
    <span class="o">-&gt;</span> <span class="n">insert_time</span> <span class="k">timestamp</span>
    <span class="o">-&gt;</span> <span class="p">);</span>
<span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">0</span> <span class="k">rows</span> <span class="n">affected</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">01</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">desc</span> <span class="n">student</span><span class="p">;</span>
<span class="o">+</span><span class="c1">-------------+-------------+------+-----+-------------------+-----------------------------+
</span><span class="c1"></span><span class="o">|</span> <span class="n">Field</span>       <span class="o">|</span> <span class="k">Type</span>        <span class="o">|</span> <span class="k">Null</span> <span class="o">|</span> <span class="k">Key</span> <span class="o">|</span> <span class="k">Default</span>           <span class="o">|</span> <span class="n">Extra</span>                       <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------------+------+-----+-------------------+-----------------------------+
</span><span class="c1"></span><span class="o">|</span> <span class="n">id</span>          <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>     <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>              <span class="o">|</span>                             <span class="o">|</span>
<span class="o">|</span> <span class="n">name</span>        <span class="o">|</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>              <span class="o">|</span>                             <span class="o">|</span>
<span class="o">|</span> <span class="n">age</span>         <span class="o">|</span> <span class="nb">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>     <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>              <span class="o">|</span>                             <span class="o">|</span>
<span class="o">|</span> <span class="n">score</span>       <span class="o">|</span> <span class="n">double</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>              <span class="o">|</span>                             <span class="o">|</span>
<span class="o">|</span> <span class="n">birthday</span>    <span class="o">|</span> <span class="nb">date</span>        <span class="o">|</span> <span class="n">YES</span>  <span class="o">|</span>     <span class="o">|</span> <span class="k">NULL</span>              <span class="o">|</span>                             <span class="o">|</span>
<span class="o">|</span> <span class="n">insert_time</span> <span class="o">|</span> <span class="k">timestamp</span>   <span class="o">|</span> <span class="k">NO</span>   <span class="o">|</span>     <span class="o">|</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="o">|</span> <span class="k">on</span> <span class="k">update</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="o">|</span>
<span class="o">+</span><span class="c1">-------------+-------------+------+-----+-------------------+-----------------------------+
</span><span class="c1"></span><span class="mi">6</span> <span class="k">rows</span> <span class="k">in</span> <span class="k">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>

<span class="n">mysql</span><span class="o">&gt;</span> 
</code></pre></td></tr></table>
</div>
</div><p>删除表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">DROP</span> <span class="k">TABLE</span> <span class="k">table_name</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>修改表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">student</span> <span class="k">RENAME</span> <span class="k">TO</span> <span class="n">new_student</span><span class="p">;</span> <span class="o">//</span><span class="err">修改表名</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">new_student</span> <span class="nb">character</span> <span class="k">SET</span> <span class="n">utf8</span><span class="p">;</span> <span class="o">//</span> <span class="err">修改表的字符集</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">new_student</span> <span class="k">ADD</span> <span class="err">列名</span> <span class="err">数据类型</span><span class="p">;</span>  <span class="o">//</span> <span class="err">给表添加列</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">new_student</span> <span class="n">CHANGE</span> <span class="err">要更改列名称</span> <span class="err">要更改为的列名称</span><span class="p">;</span>  <span class="o">//</span> <span class="err">更改列名称</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">new_student</span> <span class="k">MODIFY</span> <span class="err">列名</span> <span class="err">类型</span><span class="p">;</span>  <span class="o">//</span> <span class="err">更改列的类型</span>
<span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">new_student</span> <span class="k">DROP</span> <span class="err">列名</span><span class="p">;</span> <span class="o">//</span> <span class="err">删除表中一个列</span>
</code></pre></td></tr></table>
</div>
</div><p>插入语句</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;张三&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">student</span> <span class="p">(</span><span class="k">no</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="n">name</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;张三&#39;</span><span class="err">，</span><span class="mi">18</span><span class="p">)</span><span class="err">；</span>
</code></pre></td></tr></table>
</div>
</div><p>更新语句</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">UPDATE</span> <span class="n">student</span> <span class="k">SET</span> <span class="n">age</span><span class="o">=</span><span class="mi">16</span><span class="p">;</span>
<span class="k">UPDATE</span> <span class="n">student</span> <span class="k">SET</span> <span class="n">age</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&#34;李四&#34;</span> <span class="k">WHERE</span> <span class="k">no</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>删除语句</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">student</span> <span class="k">WHERE</span> <span class="k">no</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>注意：如果没有WHERE 条件，将删除student表中的所有数据,</p>
<p>不推荐使用，因为这里是有多少数据就执行多少次删除数据操作</p>
<p>查询语句</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-sql" data-lang="sql"><span class="k">select</span> 
	<span class="err">字段列表</span>
<span class="k">from</span>
	<span class="err">表名列表</span>
<span class="k">where</span>
	<span class="err">条件列表</span>
<span class="k">group</span>
	<span class="err">分组字段</span>
<span class="k">having</span>
	<span class="err">分组之后的条件</span>
<span class="k">order</span> <span class="k">by</span>
	<span class="err">排序</span>
<span class="k">limit</span>
	<span class="err">分页限定</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>基础查询</strong></p>
<ul>
<li>select * from student；查询数据</li>
<li>select name,age from student; 查询某些列的数据</li>
<li>select distinct address from student; 去除重复的结果集</li>
<li>select distinct name,address from student; 这里值name 和 address都相同的进行去重</li>
<li>select name,math,english , math+english from student; 计算math和english成绩之和</li>
<li>select name,math,english,math+IFNULL(english,0) from student; 这里的查询表示如果english是nulll的时候用0进行替换</li>
<li>select name 名字,math 数学,english 英语,math+IFNULL(english,0) as 总分 from student;  这里是给查询的结果起别名这里是通过as实现，也可以直接空格之后加别名</li>
</ul>
<p><strong>条件查询：</strong></p>
<p>where子句后跟条件</p>
<p>运算符：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">&gt;、 &lt;、&lt;=、&gt;=、=、&lt;&gt; 、!=
between....and: 如between 100 and 200
in(集合):集合表示多个值，使用都好分隔
like:模糊查询， 占位符：_ 表示单个任意字符 ;  % 表示多个任意字符
is null : 查询某一列为null的值，注：不能写=null
and 或 &amp;&amp;
or 或 ||
not 或 ！
</code></pre></td></tr></table>
</div>
</div><ul>
<li>查询年龄大于20的数据：select * from student where age&gt;20;</li>
<li>查询年龄大于等于20,小于等于30：select * from student where age&gt;=20 and age&lt;=30;</li>
<li>查询年龄大于等于20,小于等于30：select * from student where age between 20 and 30;</li>
<li>查询22,18,24岁的数据：select * from student where age=22 or age=18 or age=24;</li>
<li>查询22,18,24岁的数据：select * from student where age in (22,18,24);</li>
<li>select * from student where english is null; 这里切忌不能使用= 或者 !=</li>
<li>select * from student where english is not null;</li>
<li>select * from student where name like &lsquo;赵%'; 查询姓赵的人</li>
<li>select * from student where name like &lsquo;_华%'; 查询名字第二个是华的数据</li>
<li>select * from student where name like &lsquo;___'; 查询名字为3个字的数据</li>
<li>select * from student where name like &lsquo;%马%'; 查询名字包含马的数据</li>
</ul>
<p><strong>排序查询</strong></p>
<p>oder by 排序字段 排序方式（asc,desc）</p>
<ul>
<li>select * from student order by math; 按照数学成绩排序，默认位升序(asc)</li>
<li>select * from student order by math desc, english desc; 按数学成绩进行排序，如果math成绩一样，按照english成绩进行排序。 第二排序条件只有当第一排序条件无法排序时才会执行</li>
</ul>
<p><strong>聚合函数</strong></p>
<p>将一列数据作为一个整体，进行纵向的计算。</p>
<p>count: 计算个数</p>
<p>max: 计算最大值</p>
<p>min: 计算最小值</p>
<p>sum: 求和</p>
<p>注意：聚合函数的计算都是排除了null值</p>
<p>avg: 计算平均值</p>
<ul>
<li>select count(name) from student;  查询student表一共有多少学生</li>
<li>select count(ifnull(english,0)) from student; 防止为null计算数目不对的问题</li>
<li>select count(*) from sutdent;</li>
<li>select count(id) from student;</li>
<li>select max(english) from student; 查询英语成绩最高的数据</li>
<li>select min(english) from student; 查询英语成绩最低的数据</li>
<li>select sum(english) from student; 查询英语成绩的总分</li>
<li>select avg(english) from student; 查询英语成绩的平均分</li>
</ul>
<p><strong>分组查询</strong></p>
<p>语法： group by 分组字段</p>
<p>注意：</p>
<p>分组之后查询的字段：要么是分组字段，要么是聚合函数</p>
<p>where 和 having 的区别：</p>
<p>where 在分组之前进行限定，如果不满足条件，则不参与分组。having 在分组之后进行限定，如果不满足结果，则不会被查询出来。</p>
<p>where 后不可以跟聚合函数，having可以进行聚合函数的判断</p>
<ul>
<li>select sex, avg(math) from student group by sex; 计算男女同学的数据平均成绩</li>
<li>select sex, count(id) from student group by sex; 计算男女的人数</li>
<li>select sex, avg(math) from student where math&gt;70 group by sex;   计算数学成绩大于70分的男女同学的数据平均成绩</li>
<li>select sex, avg(math), count(id) from student where math&gt;70 gorup by sex having count(id) &gt;2;  having条件一定是在group by 分组之后</li>
</ul>
<p><strong>分页查询</strong></p>
<p>语法： limit 开始索引，每页查询的条数</p>
<ul>
<li>select * from student limit 0,3; 查询第一页</li>
<li>select * from student limit 3,3;查询第二页</li>
<li>select * from student limit 6,3;查询第三页</li>
</ul>
<h2 id="约束">约束</h2>
<p>对表中的数据进行限定，保证数据的正确性，有效性和完整性</p>
<p>分类：</p>
<ul>
<li>主键约束：primary key</li>
<li>非空约束:  not null</li>
<li>唯一约束：unique</li>
<li>外键约束: foreign key</li>
</ul>
<h3 id="非空约束-not-null">非空约束 not null</h3>
<p>添加非空约束的方式：</p>
<ul>
<li>
<p>创建表的时候添加约束</p>
<p>例子如下：</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CREATE</span> <span class="k">TABLE</span>  <span class="nf">stu</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span><span class="p">,</span>
  <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="c1">-- name 为非空
</span><span class="c1"></span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>还有的情况是我们创建表的时候没有添加非空的约束</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span> <span class="k">table</span> <span class="n">stu</span> <span class="n">modify</span> <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>创建表之后,手动更改表字段添加非空限制</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span> <span class="k">table</span> <span class="n">stu</span> <span class="n">modify</span> <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="唯一约束-unique">唯一约束 unique</h3>
<p>其实就是某一列的值不能重复</p>
<ul>
<li>创建唯一约束</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建表时添加唯一约束
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span>  <span class="nf">stu</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span><span class="p">,</span>
  <span class="n">phone_number</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">UNIQUE</span> <span class="c1">-- 手机号
</span><span class="c1"></span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p><strong>注意：唯一约束可以有null值，但是只能有一条记录为null</strong></p>
<ul>
<li>删除唯一约束</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span> <span class="k">table</span> <span class="n">stu</span> <span class="k">drop</span> <span class="k">index</span> <span class="n">phone_number</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在表创建完之后，添加唯一约束</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建表
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span>  <span class="nf">stu</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span><span class="p">,</span>
  <span class="n">phone_number</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="c1">-- 手机号
</span><span class="c1"></span><span class="p">);</span>
<span class="c1">-- 添加唯一约束
</span><span class="c1"></span><span class="k">alter</span> <span class="k">table</span> <span class="n">stu</span> <span class="n">modify</span> <span class="n">phone_number</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">UNIQUE</span> <span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="主键约束-primary-key">主键约束 primary key</h3>
<p>概念： 非空且唯一， 且一张表只能有一个字段位主键，通俗说主键就是表中记录的唯一标识</p>
<ul>
<li>创建表时候添加主键约束</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建表时添加主键
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span>  <span class="nf">stu</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span> <span class="k">primary</span> <span class="k">key</span> <span class="p">,</span> <span class="c1">-- 给id添加主键约束
</span><span class="c1"></span>  <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>删除主键</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 删除主键
</span><span class="c1"></span><span class="k">alter</span> <span class="k">table</span> <span class="n">stu</span> <span class="k">drop</span> <span class="k">primary</span> <span class="k">key</span> <span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>创建表之后添加主键</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建表
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span>  <span class="nf">stu</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span> <span class="p">,</span> <span class="c1">-- 给id添加主键约束
</span><span class="c1"></span>  <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 添加主键
</span><span class="c1"></span><span class="k">alter</span> <span class="k">table</span> <span class="n">stu</span> <span class="n">modify</span> <span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="自动增长-auto_increment">自动增长 auto_increment</h4>
<p>概念：如果某一列是数值类型的，使用auto_increment可以来完成值的自动增长,通常和主键一起使用，很少单独使用</p>
<ul>
<li>在创建表时添加主键约束，并完整主键自增长</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建表，添加主键约束，并设置主键自增长
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span>  <span class="nf">stu</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span> <span class="c1">-- 给id添加主键约束,并设置自增长
</span><span class="c1"></span>  <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>删除自动增长</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">alter</span> <span class="k">table</span> <span class="n">stu</span> <span class="n">modify</span> <span class="n">id</span> <span class="kt">int</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>创建表之后手动添加自增长</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建表，添加主键约束
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span>  <span class="nf">stu</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span> <span class="k">primary</span> <span class="k">key</span><span class="p">,</span> <span class="c1">-- 给id添加主键约束
</span><span class="c1"></span>  <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">alter</span> <span class="k">table</span> <span class="n">stu</span> <span class="n">modify</span> <span class="n">id</span> <span class="kt">int</span> <span class="kp">auto_increment</span> <span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="外键约束-foreign-key">外键约束 foreign key</h3>
<p>先通过一个例子来看为啥会有外键约束，通过下列sql语句创建表并插入数据：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">emp</span> <span class="p">(</span>
    <span class="n">id</span> <span class="kt">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="kp">AUTO_INCREMENT</span><span class="p">,</span>
    <span class="n">NAME</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">age</span> <span class="kt">INT</span><span class="p">,</span>
    <span class="n">dep_name</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
    <span class="n">dep_location</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">-- 添加数据
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">emp</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_name</span><span class="p">,</span> <span class="n">dep_location</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;张三&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;研发部&#39;</span><span class="p">,</span> <span class="s1">&#39;广州&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">emp</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_name</span><span class="p">,</span> <span class="n">dep_location</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;李四&#39;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="s1">&#39;研发部&#39;</span><span class="p">,</span> <span class="s1">&#39;广州&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">emp</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_name</span><span class="p">,</span> <span class="n">dep_location</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;王五&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;研发部&#39;</span><span class="p">,</span> <span class="s1">&#39;广州&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">emp</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_name</span><span class="p">,</span> <span class="n">dep_location</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;老王&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s1">&#39;销售部&#39;</span><span class="p">,</span> <span class="s1">&#39;深圳&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">emp</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_name</span><span class="p">,</span> <span class="n">dep_location</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;大王&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="s1">&#39;销售部&#39;</span><span class="p">,</span> <span class="s1">&#39;深圳&#39;</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">emp</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_name</span><span class="p">,</span> <span class="n">dep_location</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;小王&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="s1">&#39;销售部&#39;</span><span class="p">,</span> <span class="s1">&#39;深圳&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>生成如下数据：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">1	张三	20	研发部	广州
2	李四	21	研发部	广州
3	王五	20	研发部	广州
4	老王	20	销售部	深圳
5	大王	22	销售部	深圳
6	小王	18	销售部	深圳
</code></pre></td></tr></table>
</div>
</div><p>从上面的数据我们可以看到前三个人的数据和后三个人的数据显得非常冗余</p>
<p>这里有一个方案就是把这张表拆程两张表</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建部门表(id,dep_name,dep_location)
</span><span class="c1">-- 一方，主表
</span><span class="c1"></span><span class="k">create</span> <span class="k">table</span> <span class="nf">department</span><span class="p">(</span>
    <span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">dep_name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">dep_location</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">-- 创建员工表(id,name,age,dep_id)
</span><span class="c1">-- 多方，从表
</span><span class="c1"></span><span class="k">create</span> <span class="k">table</span> <span class="nf">employee</span><span class="p">(</span>
    <span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">age</span> <span class="kt">int</span><span class="p">,</span>
    <span class="n">dep_id</span> <span class="kt">int</span> <span class="c1">-- 外键对应主表的主键
</span><span class="c1"></span><span class="p">);</span>
<span class="c1">-- 添加 2 个部门
</span><span class="c1"></span><span class="k">insert</span> <span class="k">into</span> <span class="n">department</span> <span class="k">values</span><span class="p">(</span><span class="s1">&#39;研发部&#39;</span><span class="p">,</span><span class="s1">&#39;广州&#39;</span><span class="p">),(</span><span class="s1">&#39;销售部&#39;</span><span class="p">,</span> <span class="s1">&#39;深圳&#39;</span><span class="p">);</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">department</span><span class="p">;</span>
<span class="c1">-- 添加员工,dep_id 表示员工所在的部门
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;张三&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;李四&#39;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;王五&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;老王&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;大王&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;小王&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>生成如下数据：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">1	研发部	广州
2	销售部	深圳
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-fallback" data-lang="fallback">1	张三	20	1
2	李四	21	1
3	王五	20	1
4	老王	20	2
5	大王	22	2
6	小王	18	2

</code></pre></td></tr></table>
</div>
</div><p>这样我们虽然解决了数据冗余的问题，但是还有一个问题，假如有一天我们们不小心把部门数据删除了，这个时候员工表中的字段依然还存在dep_id，以及当我们添加了一个员工，但是我们填写了一个不存在dep_id</p>
<p>这里我们就需要解决员工表中的dep_id 只能是department表中存在的id, 这个时候就需要用到外键</p>
<h4 id="什么是外键">什么是外键？</h4>
<p>在从表中与主表主键对应的那一列，就像上面员工表中的dep_id</p>
<p>主表： 一方，用来约束别人的表</p>
<p>从表： 多方， 被别人约束的表</p>
<ul>
<li>创建表的时候添加外键</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建部门表(id,dep_name,dep_location)
</span><span class="c1">-- 一方，主表
</span><span class="c1"></span><span class="k">create</span> <span class="k">table</span> <span class="nf">department</span><span class="p">(</span>
    <span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">dep_name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">dep_location</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">-- 创建员工表(id,name,age,dep_id)
</span><span class="c1">-- 多方，从表
</span><span class="c1"></span><span class="k">create</span> <span class="k">table</span> <span class="nf">employee</span><span class="p">(</span>
    <span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">age</span> <span class="kt">int</span><span class="p">,</span>
    <span class="n">dep_id</span> <span class="kt">int</span><span class="p">,</span><span class="c1">-- 外键对应主表的主键
</span><span class="c1"></span>    <span class="c1">-- 创建外键约束
</span><span class="c1"></span>    <span class="k">constraint</span> <span class="n">emp_depid_fk</span> <span class="k">foreign</span> <span class="k">key</span>  <span class="p">(</span><span class="n">dep_id</span><span class="p">)</span> <span class="k">references</span> <span class="nf">department</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>

<span class="p">);</span>
<span class="c1">-- 添加 2 个部门
</span><span class="c1"></span><span class="k">insert</span> <span class="k">into</span> <span class="n">department</span> <span class="k">values</span><span class="p">(</span><span class="no">null</span><span class="p">,</span> <span class="s1">&#39;研发部&#39;</span><span class="p">,</span><span class="s1">&#39;广州&#39;</span><span class="p">),(</span><span class="no">null</span><span class="p">,</span> <span class="s1">&#39;销售部&#39;</span><span class="p">,</span> <span class="s1">&#39;深圳&#39;</span><span class="p">);</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">department</span><span class="p">;</span>
<span class="c1">-- 添加员工,dep_id 表示员工所在的部门
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;张三&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;李四&#39;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;王五&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;老王&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;大王&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">NAME</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;小王&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>上面的表和我们之前拆分之后的表表面上看着没啥区别，但是其实内在它们已经建立了联系</p>
<p>这个时候我们可以尝试删除部门表中的一个数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">db1</span><span class="o">&gt;</span> <span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">db1</span><span class="p">.</span><span class="n">department</span> <span class="k">WHERE</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">29</span> <span class="mi">16</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">55</span><span class="p">]</span> <span class="p">[</span><span class="mi">23000</span><span class="p">][</span><span class="mi">1451</span><span class="p">]</span> <span class="n">Cannot</span> <span class="k">delete</span> <span class="k">or</span> <span class="k">update</span> <span class="n">a</span> <span class="n">parent</span> <span class="n">row</span><span class="p">:</span> <span class="n">a</span> <span class="k">foreign</span> <span class="k">key</span> <span class="k">constraint</span> <span class="nf">fails</span> <span class="p">(</span><span class="o">`</span><span class="n">db1</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">employee</span><span class="o">`</span><span class="p">,</span> <span class="k">CONSTRAINT</span> <span class="o">`</span><span class="n">emp_depid_fk</span><span class="o">`</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">dep_id</span><span class="o">`</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="o">`</span><span class="n">department</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">))</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">29</span> <span class="mi">16</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mi">55</span><span class="p">]</span> <span class="p">[</span><span class="mi">23000</span><span class="p">][</span><span class="mi">1451</span><span class="p">]</span> <span class="n">Cannot</span> <span class="k">delete</span> <span class="k">or</span> <span class="k">update</span> <span class="n">a</span> <span class="n">parent</span> <span class="n">row</span><span class="p">:</span> <span class="n">a</span> <span class="k">foreign</span> <span class="k">key</span> <span class="k">constraint</span> <span class="nf">fails</span> <span class="p">(</span><span class="o">`</span><span class="n">db1</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">employee</span><span class="o">`</span><span class="p">,</span> <span class="k">CONSTRAINT</span> <span class="o">`</span><span class="n">emp_depid_fk</span><span class="o">`</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">dep_id</span><span class="o">`</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="o">`</span><span class="n">department</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">))</span>

</code></pre></td></tr></table>
</div>
</div><p>这个时候我们就可以看到因为员工表与部门表有外键关联关系，所以会提示我们无法<code>Cannot delete or update a parent row: a foreign key constraint fails...</code></p>
<p>同时这个时候我们给员工表添加一个表，同时dep_id 我们随便写一个</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="n">db1</span><span class="o">&gt;</span> <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">db1</span><span class="p">.</span><span class="nf">employee</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="s1">&#39;哈哈哈&#39;</span><span class="p">,</span> <span class="mi">222</span><span class="p">,</span> <span class="mi">2323</span><span class="p">)</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">29</span> <span class="mi">16</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="mi">23000</span><span class="p">][</span><span class="mi">1452</span><span class="p">]</span> <span class="n">Cannot</span> <span class="k">add</span> <span class="k">or</span> <span class="k">update</span> <span class="n">a</span> <span class="n">child</span> <span class="n">row</span><span class="p">:</span> <span class="n">a</span> <span class="k">foreign</span> <span class="k">key</span> <span class="k">constraint</span> <span class="nf">fails</span> <span class="p">(</span><span class="o">`</span><span class="n">db1</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">employee</span><span class="o">`</span><span class="p">,</span> <span class="k">CONSTRAINT</span> <span class="o">`</span><span class="n">emp_depid_fk</span><span class="o">`</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">dep_id</span><span class="o">`</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="o">`</span><span class="n">department</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">))</span>
<span class="p">[</span><span class="mi">2020</span><span class="o">-</span><span class="mi">09</span><span class="o">-</span><span class="mi">29</span> <span class="mi">16</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="mi">23000</span><span class="p">][</span><span class="mi">1452</span><span class="p">]</span> <span class="n">Cannot</span> <span class="k">add</span> <span class="k">or</span> <span class="k">update</span> <span class="n">a</span> <span class="n">child</span> <span class="n">row</span><span class="p">:</span> <span class="n">a</span> <span class="k">foreign</span> <span class="k">key</span> <span class="k">constraint</span> <span class="nf">fails</span> <span class="p">(</span><span class="o">`</span><span class="n">db1</span><span class="o">`</span><span class="p">.</span><span class="o">`</span><span class="n">employee</span><span class="o">`</span><span class="p">,</span> <span class="k">CONSTRAINT</span> <span class="o">`</span><span class="n">emp_depid_fk</span><span class="o">`</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="o">`</span><span class="n">dep_id</span><span class="o">`</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="o">`</span><span class="n">department</span><span class="o">`</span> <span class="p">(</span><span class="o">`</span><span class="n">id</span><span class="o">`</span><span class="p">))</span>

</code></pre></td></tr></table>
</div>
</div><p>这个时候同样因为外键的关系，我们因为上面指定的外键dep_id是个不存在的值，所以提示了：<code>Cannot add or update a child row: a foreign key constraint fails...</code></p>
<p><strong>注意： 外键值可以是null</strong></p>
<ul>
<li>删除外键</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">--  删除 employee 表的 emp_depid_fk 外键
</span><span class="c1"></span><span class="k">alter</span> <span class="k">table</span> <span class="n">employee</span> <span class="k">drop</span> <span class="k">foreign</span> <span class="k">key</span> <span class="n">emp_depid_fk</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>在employee 表已经创建的情况下，添加外键的方法</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 在 employee 表情存在的情况下添加外键
</span><span class="c1"></span><span class="k">alter</span> <span class="k">table</span> <span class="n">employee</span> <span class="k">add</span> <span class="k">constraint</span> <span class="n">emp_depid_fk</span> <span class="k">foreign</span> <span class="k">key</span>  <span class="p">(</span><span class="n">dep_id</span><span class="p">)</span> <span class="k">references</span> <span class="nf">department</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="外键的级联操作">外键的级联操作</h4>
<p>还是我们的员工表和部门表，在我们已经建立了外键关系的情况下，加入我们更新了部门表中的id字段，这个时候需要怎么做？</p>
<p>想到的笨办法就是把员工表中和这个id相关的数据的dep_id 设置为null, 然后update 部门表中的id, 最后更新员工表中的数据的dep_id 位更新后的id.但这显然不是好办法，太麻烦了，其实外键提供了更方便的设置，<strong>就是外键的级联</strong></p>
<table>
<thead>
<tr>
<th>级联操作语法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>ON UPDATE CASCADE</td>
<td>级联更新，只能是创建表的时候创建级联关系。更新主表中的主键，从表中的外键 列也自动同步更新</td>
</tr>
<tr>
<td>ON DELETE CASCADE</td>
<td>级联删除</td>
</tr>
</tbody>
</table>
<p>我们重新创建表，并添加级联：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建部门表(id,dep_name,dep_location)
</span><span class="c1">-- 一方，主表
</span><span class="c1"></span><span class="k">create</span> <span class="k">table</span> <span class="nf">department</span><span class="p">(</span>
    <span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">dep_name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">dep_location</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">-- 创建员工表(id,name,age,dep_id)
</span><span class="c1">-- 多方，从表
</span><span class="c1"></span><span class="k">create</span> <span class="k">table</span> <span class="nf">employee</span><span class="p">(</span>
    <span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">age</span> <span class="kt">int</span><span class="p">,</span>
    <span class="n">dep_id</span> <span class="kt">int</span><span class="p">,</span><span class="c1">-- 外键对应主表的主键
</span><span class="c1"></span>    <span class="c1">-- 创建外键约束, 并设置级联删除和级联更新
</span><span class="c1"></span>    <span class="k">constraint</span> <span class="n">emp_depid_fk</span> <span class="k">foreign</span> <span class="k">key</span>  <span class="p">(</span><span class="n">dep_id</span><span class="p">)</span> <span class="k">references</span> <span class="nf">department</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">update</span> <span class="k">cascade</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span> 

<span class="p">);</span>
<span class="c1">-- 添加 2 个部门
</span><span class="c1"></span><span class="k">insert</span> <span class="k">into</span> <span class="n">department</span> <span class="k">values</span><span class="p">(</span><span class="no">null</span><span class="p">,</span> <span class="s1">&#39;研发部&#39;</span><span class="p">,</span><span class="s1">&#39;广州&#39;</span><span class="p">),(</span><span class="no">null</span><span class="p">,</span> <span class="s1">&#39;销售部&#39;</span><span class="p">,</span> <span class="s1">&#39;深圳&#39;</span><span class="p">);</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">department</span><span class="p">;</span>
<span class="c1">-- 添加员工,dep_id 表示员工所在的部门
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;张三&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;李四&#39;</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;王五&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;老王&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;大王&#39;</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">employee</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">dep_id</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">&#39;小王&#39;</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>这样当我们更新部门表的id的时候都同时更新员工表中的dep_id</p>
<p>同时删除了部门的数据也会把员工表dep_id 等于 该部门iid的数据进行删除</p>
<h3 id="约束小结">约束小结</h3>
<table>
<thead>
<tr>
<th>约束名</th>
<th>关键字</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>主键</td>
<td>primary key</td>
<td>1) 唯一    2) 非空</td>
</tr>
<tr>
<td>默认</td>
<td>default</td>
<td>如果一列没有值，使用默认值</td>
</tr>
<tr>
<td>非空</td>
<td>not null</td>
<td>这一列必须有值</td>
</tr>
<tr>
<td>唯一</td>
<td>unique</td>
<td>这一列不能有重复值</td>
</tr>
<tr>
<td>外键</td>
<td>foreign key</td>
<td>主表中主键列，在从表中外键列</td>
</tr>
</tbody>
</table>
<p><strong>注意：外键的级联慎用</strong></p>
<h2 id="数据库的设计">数据库的设计</h2>
<h3 id="多表之间的关系">多表之间的关系</h3>
<h4 id="分类">分类</h4>
<ul>
<li>
<p>一对一</p>
<p>相对了来说用的场景比较少，</p>
<p>例如： 一个人和身份证号码的关系，一个人只能有一个身份证号码</p>
</li>
<li>
<p>一对多（多对一）</p>
<p>例如之前笔记中整理的：部门和员工的关系</p>
<p>一个部门可以有多个员工，一个员工只能属于一个部门</p>
</li>
<li>
<p>多对多</p>
<p>例如学生和课程之间的关系</p>
<p>一个学院可以选修多门课程，同样一门课程也可以被多个学生选修</p>
</li>
</ul>
<h4 id="实现关系">实现关系</h4>
<ul>
<li>
<p>一对多（多对一）</p>
<p>如： 部门和员工的关系</p>
<p>实现方式：在<strong>多的一方</strong>(员工表)去建立外键，来指向<strong>一的一方</strong>（部门表）的主键
例子:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建部门表(id,dep_name,dep_location)
</span><span class="c1">-- 一方，主表
</span><span class="c1"></span><span class="k">create</span> <span class="k">table</span> <span class="nf">department</span><span class="p">(</span>
    <span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">dep_name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">dep_location</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>
<span class="c1">-- 创建员工表(id,name,age,dep_id)
</span><span class="c1">-- 多方，从表
</span><span class="c1"></span><span class="k">create</span> <span class="k">table</span> <span class="nf">employee</span><span class="p">(</span>
    <span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">age</span> <span class="kt">int</span><span class="p">,</span>
    <span class="n">dep_id</span> <span class="kt">int</span><span class="p">,</span><span class="c1">-- 外键对应主表的主键
</span><span class="c1"></span>    <span class="c1">-- 创建外键约束, 并设置级联删除和级联更新
</span><span class="c1"></span>    <span class="k">constraint</span> <span class="n">emp_depid_fk</span> <span class="k">foreign</span> <span class="k">key</span>  <span class="p">(</span><span class="n">dep_id</span><span class="p">)</span> <span class="k">references</span> <span class="nf">department</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">on</span> <span class="k">update</span> <span class="k">cascade</span> <span class="k">on</span> <span class="k">delete</span> <span class="k">cascade</span>
  
<span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>多对多</p>
<p>如：学生和课程的关系</p>
<p>实现方式：多对多关系实现需要借助第三张中间表，中间表至少包含两个字段，这两个字段作为第三张表的外键，分别指向两张表（课程表和学生表）的主键</p>
</li>
<li>
<p>一对一</p>
<p>如：人和身份证</p>
<p>实现方式： 一对一关系实现，可以在任意一方添加唯一外键指向另一方的主键</p>
<p>备注： 这种用法较少，因为这个时候通常会合成一张表</p>
</li>
</ul>
<h4 id="实际案例">实际案例</h4>
<ul>
<li>
<p>一对多案例</p>
<p>京东和淘宝的手机分类中会有各个手机品牌，而每个手机品牌下会有很多手机型号，这就是非常典型的一对多关系</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 创建手机品牌类别表phone_category
</span><span class="c1">-- pid 手机分类主键自动增长
</span><span class="c1">-- pname 手机类别的名字，如苹果, 小米
</span><span class="c1"></span><span class="k">create</span> <span class="k">table</span> <span class="nf">phone_category</span> <span class="p">(</span>
    <span class="n">cid</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">cname</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">not</span> <span class="no">null</span> <span class="k">unique</span>
<span class="p">);</span>
  
<span class="c1">-- 添加手机牌子
</span><span class="c1"></span><span class="k">insert</span> <span class="k">into</span> <span class="nf">phone_category</span> <span class="p">(</span><span class="n">cname</span><span class="p">)</span> <span class="k">values</span> <span class="p">(</span><span class="s2">&#34;苹果&#34;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&#34;小米&#34;</span><span class="p">),(</span><span class="s2">&#34;三星&#34;</span><span class="p">);</span>
  
  
<span class="c1">-- 创建具体手机表
</span><span class="c1"></span><span class="cm">/*
</span><span class="cm">pid 手机表主键，自动增长
</span><span class="cm">pname 手机名字
</span><span class="cm">price 价格
</span><span class="cm">cid 外键
</span><span class="cm">*/</span>
<span class="k">create</span> <span class="k">table</span> <span class="nf">phone_name</span> <span class="p">(</span>
    <span class="n">pid</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">pname</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">not</span> <span class="no">null</span> <span class="k">unique</span> <span class="p">,</span>
    <span class="n">price</span> <span class="kt">double</span><span class="p">,</span>
    <span class="n">cid</span> <span class="kt">int</span><span class="p">,</span>
    <span class="k">constraint</span> <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">cid</span><span class="p">)</span> <span class="k">references</span> <span class="nf">phone_category</span><span class="p">(</span><span class="n">cid</span><span class="p">)</span>
<span class="p">);</span>
  
<span class="c1">-- 添加手机数据
</span><span class="c1"></span><span class="k">insert</span> <span class="k">into</span> <span class="n">phone_name</span> <span class="k">values</span>
                              <span class="p">(</span><span class="no">NULL</span><span class="p">,</span> <span class="s2">&#34;IPhonex&#34;</span><span class="p">,</span><span class="mi">4999</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                              <span class="p">(</span><span class="no">NULL</span><span class="p">,</span> <span class="s2">&#34;IPhone11&#34;</span><span class="p">,</span><span class="mi">5999</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                              <span class="p">(</span><span class="no">NUll</span><span class="p">,</span> <span class="s2">&#34;mi6&#34;</span><span class="p">,</span><span class="mi">1999</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                              <span class="p">(</span><span class="no">NUll</span><span class="p">,</span> <span class="s2">&#34;mi10&#34;</span><span class="p">,</span><span class="mi">2999</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                              <span class="p">(</span><span class="no">NUll</span><span class="p">,</span> <span class="s2">&#34;s8&#34;</span><span class="p">,</span><span class="mi">6999</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                              <span class="p">(</span><span class="no">NUll</span><span class="p">,</span> <span class="s2">&#34;s10&#34;</span><span class="p">,</span><span class="mi">7999</span><span class="p">.</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>多对多案例</p>
<p>还是关于手机的案例，接着上面一对多的案例，其实我们再添加一个关系手机存储，就像手机有64G，128G, 256G, 不管那个手机都会有多个存储的，所以这里的手机和存储之间的关系就是多对多的关系</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="cm">/*
</span><span class="cm">创建手机存储表
</span><span class="cm">mid 存储表的id,自增长
</span><span class="cm">memory 内存大小，唯一，非空
</span><span class="cm">*/</span>
<span class="k">create</span> <span class="k">table</span> <span class="nf">phone_memory</span> <span class="p">(</span>
    <span class="n">mid</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
    <span class="n">memory</span> <span class="kt">int</span> <span class="k">not</span> <span class="no">null</span> <span class="k">unique</span>
<span class="p">);</span>
  
  
<span class="c1">-- 添加内存数据
</span><span class="c1"></span><span class="k">insert</span> <span class="k">into</span> <span class="n">phone_memory</span> <span class="k">values</span>
                                <span class="p">(</span><span class="no">NULL</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span>
                                <span class="p">(</span><span class="no">NULL</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
                                <span class="p">(</span><span class="no">NULL</span><span class="p">,</span> <span class="mi">256</span><span class="p">);</span>
  
  
<span class="cm">/*
</span><span class="cm"> 创建第三张表存手机和内存之间的关系
</span><span class="cm"> mid 内存的id 外键
</span><span class="cm"> pid 手机的id 外键
</span><span class="cm"> */</span>
  
 <span class="k">create</span> <span class="k">table</span> <span class="nf">phone_m2m_memory</span><span class="p">(</span>
     <span class="n">mid</span> <span class="kt">int</span><span class="p">,</span>
     <span class="n">pid</span> <span class="kt">int</span><span class="p">,</span>
     <span class="k">primary</span> <span class="k">key</span> <span class="p">(</span><span class="n">mid</span><span class="p">,</span><span class="n">pid</span><span class="p">),</span>
     <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">mid</span><span class="p">)</span> <span class="k">references</span> <span class="nf">phone_memory</span><span class="p">(</span><span class="n">mid</span><span class="p">),</span>
     <span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">pid</span><span class="p">)</span> <span class="k">references</span> <span class="nf">phone_name</span><span class="p">(</span><span class="n">pid</span><span class="p">)</span>
 <span class="p">);</span>
  
<span class="c1">-- 增加手机内存数据
</span><span class="c1"></span>  
<span class="k">insert</span> <span class="k">into</span> <span class="n">phone_m2m_memory</span> <span class="k">values</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span>
                                    <span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="表与表关系小结">表与表关系小结</h4>
<table>
<thead>
<tr>
<th>表与表关系</th>
<th>关系的维护</th>
</tr>
</thead>
<tbody>
<tr>
<td>一对多</td>
<td>主外键的关系</td>
</tr>
<tr>
<td>多对多</td>
<td>中间表，两个一对多</td>
</tr>
<tr>
<td>一对一</td>
<td>1）特殊一对多，从表中的外键设置为唯一 2）从表中的</td>
</tr>
</tbody>
</table>
<h3 id="数据库设计的范式">数据库设计的范式</h3>
<p>概念： 在设计数据库的时候需要遵循的规范。 要遵循后面的范式，必须先遵循前面的所有范式。</p>
<p>目前关系数据库有六种范式：第一范式（1NF）、第二范式（2NF）、第三范式（3NF）、巴斯-科德范式（BCNF）、第四范式(4NF）和第五范式（5NF，又称完美范式）。</p>
<p>掌握前三个设计出来的数据库基本不会有啥大问题</p>
<p>第一范式（1NF）：用一句话总结就是每一列是不可分割的原子数据项</p>
<p>第二范式（2NF）:   在1NF的基础上，非码属性必须完全依赖于候选码（在1NF基础上消除非主属性对主码的部分函数依赖）</p>
<p>概念补充：</p>
<ul>
<li>
<p>函数依赖：</p>
<p>A&ndash;&gt;B,如果通过A属性(属性组)的值，可以确定唯一B属性的值。则称B依    赖于A</p>
<p>例如：学号&ndash;&gt;姓名。  （学号，课程名称） &ndash;&gt; 分数</p>
</li>
<li>
<p>完全函数依赖：</p>
<p>A&ndash;&gt;B， 如果A是一个属性组，则B属性值得确定需要依赖于A属性组中所有的属性值。</p>
<p>例如：（学号，课程名称） &ndash;&gt; 分数</p>
</li>
<li>
<p>部分函数依赖：</p>
<p>A&ndash;&gt;B， 如果A是一个属性组，则B属性值得确定只需要依赖于A属性组中某一些值即可。</p>
<p>例如：（学号，课程名称） &ndash; &gt; 姓名</p>
</li>
<li>
<p>传递函数依赖：</p>
<p>A&ndash;&gt;B, B &ndash; &gt;C . 如果通过A属性(属性组)的值，可以确定唯一B属性的值，在通过B属性（属性组）的值可以确定唯一C属性的值，则称 C 传递函数依赖于A</p>
<p>例如：学号&ndash;&gt;系名，系名&ndash;&gt;系主任</p>
</li>
<li>
<p>码：</p>
<p>如果在一张表中，一个属性或属性组，被其他所有属性所完全依赖，则称这个属性(属性组)为该表的码</p>
<p>例如：该表中码为：（学号，课程名称）</p>
<p>主属性：码属性组中的所有属性</p>
<p>非主属性：除了码属性组的属性</p>
</li>
</ul>
<p>传递函数依赖：</p>
<p>A&ndash;&gt;B, B &ndash; &gt;C . 如果通过A属性(属性组)的值，可以确定唯一B属性的值，在通过B属性（属性组）的值可以确定唯一C属性的值，则称 C 传递函数依赖于A</p>
<p>第三范式 (3NF):    在2NF基础上，任何非主属性不依赖于其它非主属性（在2NF基础上消除传递依赖）</p>
<h4 id="案例">案例</h4>
<p><a href="https://imgchr.com/i/3j27AH" target="_blank" rel="noopener noreffer"><img
        class="lazyload"
        src="/svg/loading.small.min.svg"
        data-sizes="auto"
        data-srcset="https://s2.ax1x.com/2020/03/07/3j27AH.png,  1.5x,  2x"
        data-src=""
        alt="3j27AH.png"
        title="3j27AH.png" /></a>
</p>
<p><img
        class="lazyload"
        src="/svg/loading.small.min.svg"
        data-sizes="auto"
        data-srcset="https://s2.ax1x.com/2020/03/07/3jRM59.png,  1.5x,  2x"
        data-src=""
        alt="3jRM59.png"
        title="3jRM59.png" /></p>
<p><img
        class="lazyload"
        src="/svg/loading.small.min.svg"
        data-sizes="auto"
        data-srcset="https://s2.ax1x.com/2020/03/07/3jRtbD.png,  1.5x,  2x"
        data-src=""
        alt="3jRtbD.png"
        title="3jRtbD.png" /></p>
<p><a href="https://imgchr.com/i/3jR52q" target="_blank" rel="noopener noreffer"><img
        class="lazyload"
        src="/svg/loading.small.min.svg"
        data-sizes="auto"
        data-srcset="https://s2.ax1x.com/2020/03/07/3jR52q.md.png,  1.5x,  2x"
        data-src=""
        alt="3jR52q.md.png"
        title="3jR52q.md.png" /></a>
</p>
<h2 id="多表查询">多表查询</h2>
<h3 id="基础数据">基础数据</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">create</span> <span class="k">table</span> <span class="nf">dept</span><span class="p">(</span>
	<span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
	<span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="nf">dept</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="s1">&#39;研发部&#39;</span><span class="p">),(</span><span class="s1">&#39;市场部&#39;</span><span class="p">),(</span><span class="s1">&#39;财务部&#39;</span><span class="p">);</span>

<span class="k">create</span> <span class="k">table</span> <span class="nf">emp</span><span class="p">(</span>
	<span class="n">id</span> <span class="kt">int</span> <span class="k">primary</span> <span class="k">key</span> <span class="kp">auto_increment</span><span class="p">,</span>
	<span class="n">name</span> <span class="kt">varchar</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
	<span class="n">gender</span> <span class="kt">char</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="c1">-- 性别
</span><span class="c1"></span>	<span class="n">salary</span> <span class="kt">double</span><span class="p">,</span> <span class="c1">-- 工资
</span><span class="c1"></span>	<span class="n">join_date</span> <span class="kt">date</span><span class="p">,</span> <span class="c1">-- 入职日期
</span><span class="c1"></span>	<span class="n">dept_id</span> <span class="kt">INT</span><span class="p">,</span>
	<span class="k">foreign</span> <span class="k">key</span> <span class="p">(</span><span class="n">dept_id</span><span class="p">)</span> <span class="k">references</span> <span class="nf">dept</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="c1">-- 外键，关联部门表的主键
</span><span class="c1"></span><span class="p">);</span>

<span class="k">insert</span> <span class="k">into</span> <span class="nf">emp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span> <span class="n">join_date</span><span class="p">,</span><span class="n">dept_id</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="s1">&#39;张三&#39;</span><span class="p">,</span><span class="s1">&#39;男&#39;</span><span class="p">,</span> <span class="mi">12000</span><span class="p">,</span> <span class="s1">&#39;2020-01-01&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="nf">emp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span> <span class="n">join_date</span><span class="p">,</span><span class="n">dept_id</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="s1">&#39;李四&#39;</span><span class="p">,</span><span class="s1">&#39;男&#39;</span><span class="p">,</span> <span class="mi">22000</span><span class="p">,</span> <span class="s1">&#39;2019-03-01&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="nf">emp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span> <span class="n">join_date</span><span class="p">,</span><span class="n">dept_id</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="s1">&#39;王五&#39;</span><span class="p">,</span><span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">3200</span><span class="p">,</span> <span class="s1">&#39;2025-02-01&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
<span class="k">insert</span> <span class="k">into</span> <span class="nf">emp</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span> <span class="n">join_date</span><span class="p">,</span><span class="n">dept_id</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="s1">&#39;哈哈&#39;</span><span class="p">,</span><span class="s1">&#39;女&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;2000-12-01&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="多表查询-1">多表查询</h2>
<h3 id="内连接查询">内连接查询</h3>
<h4 id="隐式内连接">隐式内连接</h4>
<p>使用where条件消除无用信息</p>
<p>例如：查询所有员工信息和对应的部门信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">emp</span><span class="p">,</span><span class="n">dept</span> <span class="k">where</span> <span class="n">emp</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span><span class="n">dept</span><span class="p">.</span><span class="n">id</span>
</code></pre></td></tr></table>
</div>
</div><p>例如：查询员工表的名称，性别，部门表的名称</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="n">emp</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span><span class="n">dept</span><span class="p">.</span><span class="n">name</span> <span class="k">from</span> <span class="n">emp</span><span class="p">,</span><span class="n">dept</span> <span class="k">where</span> <span class="n">emp</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span> <span class="n">dept</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span>
	<span class="n">t1</span><span class="p">.</span><span class="n">name</span><span class="p">,</span><span class="n">t1</span><span class="p">.</span><span class="n">gender</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">name</span>
<span class="k">from</span> 
	<span class="n">emp</span> <span class="n">t1</span><span class="p">,</span> <span class="n">dept</span> <span class="n">t2</span>
<span class="k">where</span>
	<span class="n">t1</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span><span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="显式内连接">显式内连接</h4>
<p>语法： select 字段列表 from 表名 inner join 表名2 on 条件</p>
<p>inner 关键字可以省略</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">emp</span> <span class="k">inner</span> <span class="k">join</span> <span class="n">dept</span> <span class="k">on</span> <span class="n">emp</span><span class="p">.</span><span class="n">dept_id</span> <span class="o">=</span> <span class="n">dept</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="外连接查询">外连接查询</h3>
<h4 id="左外连接">左外连接</h4>
<p>语法：select 字段列表 from 表1 left outer join 表2 on 条件</p>
<p>outer 关键字可以省略</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span>
	<span class="n">t1</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">name</span>
<span class="k">from</span>
	<span class="n">emp</span> <span class="n">t1</span>
<span class="k">left</span> <span class="k">join</span>
	<span class="n">dept</span> <span class="n">t2</span>
<span class="k">on</span>
	<span class="n">t1</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span><span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>总结过可以看出其实左外连接查询的是左表所有数据以及其他交集部分</p>
<h4 id="右外连接">右外连接</h4>
<p>语法：select 字段列表 from 表1 right outer join 表2 on 条件</p>
<p>outer 关键字可以省略</p>
<p>其实右外连接查询的是右表所有数据以及其他交集部分</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span>
	<span class="n">t1</span><span class="p">.</span><span class="o">*</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">name</span>
<span class="k">from</span>
	<span class="n">emp</span> <span class="n">t1</span>
<span class="k">right</span> <span class="k">join</span>
	<span class="n">dept</span> <span class="n">t2</span>
<span class="k">on</span>
	<span class="n">t1</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span><span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="子查询">子查询</h3>
<p>概念： 查询中嵌套查询，称为子查询.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">emp</span> <span class="k">where</span> <span class="n">emp</span><span class="p">.</span><span class="n">salary</span><span class="o">=</span><span class="p">(</span><span class="k">select</span> <span class="nf">max</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span> <span class="k">from</span> <span class="n">emp</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><p>子查询包含几种不同的情况：</p>
<ul>
<li>子查询的结果是单行单列</li>
<li>子查询的结果是多行单列的</li>
<li>子查询的结果是多行多列的</li>
</ul>
<h4 id="子查询的结果是单行单列">子查询的结果是单行单列</h4>
<p>子查询可以作为条件，使用运算符去判断。  运算符： <strong>&gt; , &gt;= , &lt;=, =</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="o">-</span><span class="c1">-- 查询员工工资小于平均工资的人
</span><span class="c1"></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">emp</span> <span class="k">where</span> <span class="n">emp</span><span class="p">.</span><span class="n">salary</span> <span class="o">&lt;</span> <span class="p">(</span><span class="k">select</span> <span class="nf">avg</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span> <span class="k">from</span> <span class="n">emp</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="子查寻的结果是多行单列">子查寻的结果是多行单列</h4>
<p>子查询可以作为条件，使用运算符<strong>in</strong>来判断</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 查询财务部和市场部所有员工的信息
</span><span class="c1"></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">emp</span> <span class="k">where</span> <span class="n">dept_id</span> <span class="k">in</span> <span class="p">(</span><span class="k">select</span> <span class="n">id</span> <span class="k">from</span> <span class="n">dept</span> <span class="k">where</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;财务部&#39;</span> <span class="k">or</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;市场部&#39;</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="子查询的结果是多行多列的">子查询的结果是多行多列的</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 查询入职日期在2019-01-01 之后的员工信息和部门信息
</span><span class="c1"></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">dept</span> <span class="n">t1</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">emp</span> <span class="k">where</span> <span class="n">emp</span><span class="p">.</span><span class="n">join_date</span><span class="o">&gt;</span><span class="s1">&#39;2019-01-01&#39;</span><span class="p">)</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">--  通过内连接也可以;
</span><span class="c1"></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">dept</span> <span class="n">t1</span><span class="p">,</span> <span class="n">emp</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">t2</span><span class="p">.</span><span class="n">join_date</span><span class="o">&gt;</span><span class="s1">&#39;2019-01-01&#39;</span> <span class="k">and</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="多表查询练习">多表查询练习</h3>
<p>基础数据</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 部门表
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">dept</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- 部门id
</span><span class="c1"></span>  <span class="n">dname</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="c1">-- 部门名称
</span><span class="c1"></span>  <span class="n">loc</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="c1">-- 部门所在地
</span><span class="c1"></span><span class="p">);</span>

<span class="c1">-- 添加4个部门
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">dept</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">dname</span><span class="p">,</span><span class="n">loc</span><span class="p">)</span> <span class="k">VALUES</span> 
<span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;教研部&#39;</span><span class="p">,</span><span class="s1">&#39;北京&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="s1">&#39;学工部&#39;</span><span class="p">,</span><span class="s1">&#39;上海&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="s1">&#39;销售部&#39;</span><span class="p">,</span><span class="s1">&#39;广州&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">40</span><span class="p">,</span><span class="s1">&#39;财务部&#39;</span><span class="p">,</span><span class="s1">&#39;深圳&#39;</span><span class="p">);</span>



<span class="c1">-- 职务表，职务名称，职务描述
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">job</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
  <span class="n">jname</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
  <span class="n">description</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 添加4个职务
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">job</span> <span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">jname</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span> <span class="k">VALUES</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;董事长&#39;</span><span class="p">,</span> <span class="s1">&#39;管理整个公司，接单&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;经理&#39;</span><span class="p">,</span> <span class="s1">&#39;管理部门员工&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;销售员&#39;</span><span class="p">,</span> <span class="s1">&#39;向客人推销产品&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;文员&#39;</span><span class="p">,</span> <span class="s1">&#39;使用办公软件&#39;</span><span class="p">);</span>



<span class="c1">-- 员工表
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">emp</span> <span class="p">(</span>
  <span class="n">id</span> <span class="kt">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="c1">-- 员工id
</span><span class="c1"></span>  <span class="n">ename</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">),</span> <span class="c1">-- 员工姓名
</span><span class="c1"></span>  <span class="n">job_id</span> <span class="kt">INT</span><span class="p">,</span> <span class="c1">-- 职务id
</span><span class="c1"></span>  <span class="n">mgr</span> <span class="kt">INT</span> <span class="p">,</span> <span class="c1">-- 上级领导
</span><span class="c1"></span>  <span class="n">joindate</span> <span class="kt">DATE</span><span class="p">,</span> <span class="c1">-- 入职日期
</span><span class="c1"></span>  <span class="n">salary</span> <span class="kt">DECIMAL</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="c1">-- 工资
</span><span class="c1"></span>  <span class="n">bonus</span> <span class="kt">DECIMAL</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="c1">-- 奖金
</span><span class="c1"></span>  <span class="n">dept_id</span> <span class="kt">INT</span><span class="p">,</span> <span class="c1">-- 所在部门编号
</span><span class="c1"></span>  <span class="k">CONSTRAINT</span> <span class="n">emp_jobid_ref_job_id_fk</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">job_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="nf">job</span> <span class="p">(</span><span class="n">id</span><span class="p">),</span>
  <span class="k">CONSTRAINT</span> <span class="n">emp_deptid_ref_dept_id_fk</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">dept_id</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="nf">dept</span> <span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="c1">-- 添加员工
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">emp</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">ename</span><span class="p">,</span><span class="n">job_id</span><span class="p">,</span><span class="n">mgr</span><span class="p">,</span><span class="n">joindate</span><span class="p">,</span><span class="n">salary</span><span class="p">,</span><span class="n">bonus</span><span class="p">,</span><span class="n">dept_id</span><span class="p">)</span> <span class="k">VALUES</span> 
<span class="p">(</span><span class="mi">1001</span><span class="p">,</span><span class="s1">&#39;孙悟空&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1004</span><span class="p">,</span><span class="s1">&#39;2000-12-17&#39;</span><span class="p">,</span><span class="s1">&#39;8000.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1002</span><span class="p">,</span><span class="s1">&#39;卢俊义&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1006</span><span class="p">,</span><span class="s1">&#39;2001-02-20&#39;</span><span class="p">,</span><span class="s1">&#39;16000.00&#39;</span><span class="p">,</span><span class="s1">&#39;3000.00&#39;</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1003</span><span class="p">,</span><span class="s1">&#39;林冲&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1006</span><span class="p">,</span><span class="s1">&#39;2001-02-22&#39;</span><span class="p">,</span><span class="s1">&#39;12500.00&#39;</span><span class="p">,</span><span class="s1">&#39;5000.00&#39;</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1004</span><span class="p">,</span><span class="s1">&#39;唐僧&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1009</span><span class="p">,</span><span class="s1">&#39;2001-04-02&#39;</span><span class="p">,</span><span class="s1">&#39;29750.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1005</span><span class="p">,</span><span class="s1">&#39;李逵&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1006</span><span class="p">,</span><span class="s1">&#39;2001-09-28&#39;</span><span class="p">,</span><span class="s1">&#39;12500.00&#39;</span><span class="p">,</span><span class="s1">&#39;14000.00&#39;</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1006</span><span class="p">,</span><span class="s1">&#39;宋江&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1009</span><span class="p">,</span><span class="s1">&#39;2001-05-01&#39;</span><span class="p">,</span><span class="s1">&#39;28500.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1007</span><span class="p">,</span><span class="s1">&#39;刘备&#39;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1009</span><span class="p">,</span><span class="s1">&#39;2001-09-01&#39;</span><span class="p">,</span><span class="s1">&#39;24500.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1008</span><span class="p">,</span><span class="s1">&#39;猪八戒&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1004</span><span class="p">,</span><span class="s1">&#39;2007-04-19&#39;</span><span class="p">,</span><span class="s1">&#39;30000.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1009</span><span class="p">,</span><span class="s1">&#39;罗贯中&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="s1">&#39;2001-11-17&#39;</span><span class="p">,</span><span class="s1">&#39;50000.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1010</span><span class="p">,</span><span class="s1">&#39;吴用&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1006</span><span class="p">,</span><span class="s1">&#39;2001-09-08&#39;</span><span class="p">,</span><span class="s1">&#39;15000.00&#39;</span><span class="p">,</span><span class="s1">&#39;0.00&#39;</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1011</span><span class="p">,</span><span class="s1">&#39;沙僧&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1004</span><span class="p">,</span><span class="s1">&#39;2007-05-23&#39;</span><span class="p">,</span><span class="s1">&#39;11000.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1012</span><span class="p">,</span><span class="s1">&#39;李逵&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1006</span><span class="p">,</span><span class="s1">&#39;2001-12-03&#39;</span><span class="p">,</span><span class="s1">&#39;9500.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">30</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1013</span><span class="p">,</span><span class="s1">&#39;小白龙&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1004</span><span class="p">,</span><span class="s1">&#39;2001-12-03&#39;</span><span class="p">,</span><span class="s1">&#39;30000.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">20</span><span class="p">),</span>
<span class="p">(</span><span class="mi">1014</span><span class="p">,</span><span class="s1">&#39;关羽&#39;</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1007</span><span class="p">,</span><span class="s1">&#39;2002-01-23&#39;</span><span class="p">,</span><span class="s1">&#39;13000.00&#39;</span><span class="p">,</span><span class="no">NULL</span><span class="p">,</span><span class="mi">10</span><span class="p">);</span>



<span class="c1">-- 工资等级表
</span><span class="c1"></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">salarygrade</span> <span class="p">(</span>
  <span class="n">grade</span> <span class="kt">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>   <span class="c1">-- 级别
</span><span class="c1"></span>  <span class="n">losalary</span> <span class="kt">INT</span><span class="p">,</span>  <span class="c1">-- 最低工资
</span><span class="c1"></span>  <span class="n">hisalary</span> <span class="kt">INT</span> <span class="c1">-- 最高工资
</span><span class="c1"></span><span class="p">);</span>

<span class="c1">-- 添加5个工资等级
</span><span class="c1"></span><span class="k">INSERT</span> <span class="k">INTO</span> <span class="nf">salarygrade</span><span class="p">(</span><span class="n">grade</span><span class="p">,</span><span class="n">losalary</span><span class="p">,</span><span class="n">hisalary</span><span class="p">)</span> <span class="k">VALUES</span> 
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7000</span><span class="p">,</span><span class="mi">12000</span><span class="p">),</span>
<span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">12010</span><span class="p">,</span><span class="mi">14000</span><span class="p">),</span>
<span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">14010</span><span class="p">,</span><span class="mi">20000</span><span class="p">),</span>
<span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">20010</span><span class="p">,</span><span class="mi">30000</span><span class="p">),</span>
<span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">30010</span><span class="p">,</span><span class="mi">99990</span><span class="p">);</span>

<span class="c1">-- 需求：
</span><span class="c1"></span>
<span class="c1">-- 1.查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述
</span><span class="c1"></span>
<span class="c1">-- 2.查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置
</span><span class="c1"></span>   
<span class="c1">-- 3.查询员工姓名，工资，工资等级
</span><span class="c1"></span>
<span class="c1">-- 4.查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级
</span><span class="c1"></span>
<span class="c1">-- 5.查询出部门编号、部门名称、部门位置、部门人数
</span><span class="c1"></span> 
<span class="c1">-- 6.查询所有员工的姓名及其直接上级的姓名,没有领导的员工也需要查询
</span><span class="c1"></span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 查询所有员工信息。查询员工编号，员工姓名，工资，职务名称，职务描述
</span><span class="c1"></span><span class="k">select</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="n">t1</span><span class="p">.</span><span class="n">ename</span><span class="p">,</span><span class="n">t1</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">jname</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">description</span> <span class="k">from</span> <span class="n">emp</span> <span class="n">t1</span><span class="p">,</span> <span class="n">job</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">t1</span><span class="p">.</span><span class="n">job_id</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 查询员工编号，员工姓名，工资，职务名称，职务描述，部门名称，部门位置
</span><span class="c1"></span><span class="k">select</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="n">t1</span><span class="p">.</span><span class="n">ename</span><span class="p">,</span><span class="n">t1</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">jname</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">description</span><span class="p">,</span><span class="n">t3</span><span class="p">.</span><span class="n">dname</span><span class="p">,</span><span class="n">t3</span><span class="p">.</span><span class="n">loc</span> <span class="k">from</span> <span class="n">emp</span> <span class="n">t1</span><span class="p">,</span> <span class="n">job</span> <span class="n">t2</span><span class="p">,</span> <span class="n">dept</span> <span class="n">t3</span>  <span class="k">where</span> <span class="n">t1</span><span class="p">.</span><span class="n">job_id</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span> <span class="k">and</span> <span class="n">t1</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span><span class="n">t3</span><span class="p">.</span><span class="n">id</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查询员工姓名，工资，工资等级</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 查询员工姓名，工资，工资等级
</span><span class="c1"></span><span class="k">select</span> <span class="n">t1</span><span class="p">.</span><span class="n">ename</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="n">grade</span> <span class="k">from</span> <span class="n">salarygrade</span> <span class="k">where</span>  <span class="n">t1</span><span class="p">.</span><span class="n">salary</span><span class="o">&gt;</span> <span class="n">losalary</span> <span class="k">and</span> <span class="n">salary</span><span class="o">&lt;</span><span class="n">hisalary</span><span class="p">)</span>  <span class="n">grade</span> <span class="k">from</span> <span class="n">emp</span> <span class="n">t1</span>
</code></pre></td></tr></table>
</div>
</div><p>或者</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="n">t1</span><span class="p">.</span><span class="n">ename</span><span class="p">,</span><span class="n">t1</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">grade</span> <span class="k">from</span> <span class="n">emp</span> <span class="n">t1</span><span class="p">,</span> <span class="n">salarygrade</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">t1</span><span class="p">.</span><span class="n">salary</span> <span class="o">&gt;</span> <span class="n">t2</span><span class="p">.</span><span class="n">losalary</span> <span class="k">and</span> <span class="n">t1</span><span class="p">.</span><span class="n">salary</span> <span class="o">&lt;</span> <span class="n">t2</span><span class="p">.</span><span class="n">hisalary</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 查询员工姓名，工资，职务名称，职务描述，部门名称，部门位置，工资等级
</span><span class="c1"></span><span class="k">select</span>
       <span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="p">,</span><span class="n">t1</span><span class="p">.</span><span class="n">ename</span><span class="p">,</span><span class="n">t1</span><span class="p">.</span><span class="n">salary</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">jname</span><span class="p">,</span><span class="n">t2</span><span class="p">.</span><span class="n">description</span><span class="p">,</span><span class="n">t3</span><span class="p">.</span><span class="n">dname</span><span class="p">,</span><span class="n">t3</span><span class="p">.</span><span class="n">loc</span> <span class="p">,</span><span class="n">t4</span><span class="p">.</span><span class="n">grade</span>
<span class="k">from</span> <span class="n">emp</span> <span class="n">t1</span><span class="p">,</span> <span class="n">job</span> <span class="n">t2</span><span class="p">,</span> <span class="n">dept</span> <span class="n">t3</span><span class="p">,</span> <span class="n">salarygrade</span> <span class="n">t4</span>
<span class="k">where</span>
      <span class="n">t1</span><span class="p">.</span><span class="n">job_id</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span>
  <span class="k">and</span>
      <span class="n">t1</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span><span class="n">t3</span><span class="p">.</span><span class="n">id</span>
<span class="k">and</span> <span class="p">(</span><span class="n">t1</span><span class="p">.</span><span class="n">salary</span> <span class="o">&gt;</span> <span class="n">t4</span><span class="p">.</span><span class="n">losalary</span> <span class="k">and</span> <span class="n">t1</span><span class="p">.</span><span class="n">salary</span> <span class="o">&lt;</span> <span class="n">t4</span><span class="p">.</span><span class="n">hisalary</span><span class="p">);</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查询出部门编号、部门名称、部门位置、部门人数</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 查询出部门编号、部门名称、部门位置、部门人数
</span><span class="c1"></span><span class="k">select</span> <span class="n">t1</span><span class="p">.</span><span class="n">dname</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">loc</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="nf">count</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>  <span class="k">from</span> <span class="n">emp</span> <span class="k">where</span> <span class="n">emp</span><span class="p">.</span><span class="n">dept_id</span><span class="o">=</span><span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="p">)</span> <span class="n">count</span> <span class="k">from</span> <span class="n">dept</span> <span class="n">t1</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">t1</span><span class="p">.</span><span class="n">dname</span><span class="p">,</span><span class="n">t1</span><span class="p">.</span><span class="n">loc</span><span class="p">,</span> <span class="n">t2</span><span class="p">.</span><span class="n">total</span> <span class="k">from</span> <span class="n">dept</span> <span class="n">t1</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="n">dept_id</span><span class="p">,</span><span class="nf">count</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="n">total</span> <span class="k">from</span> <span class="n">emp</span> <span class="k">group</span> <span class="k">by</span> <span class="n">dept_id</span><span class="p">)</span> <span class="n">t2</span> <span class="k">where</span> <span class="n">t1</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">dept_id</span>
</code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>查询所有员工的姓名及其直接上级的姓名,没有领导的员工也需要查询</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="c1">-- 查询所有员工的姓名及其直接上级的姓名,没有领导的员工也需要查询
</span><span class="c1"></span><span class="k">select</span> <span class="n">t1</span><span class="p">.</span><span class="n">ename</span><span class="p">,</span> <span class="p">(</span><span class="k">select</span> <span class="n">ename</span> <span class="k">from</span> <span class="n">emp</span> <span class="k">where</span> <span class="n">t1</span><span class="p">.</span><span class="n">mgr</span><span class="o">=</span><span class="n">id</span><span class="p">)</span><span class="k">from</span> <span class="n">emp</span> <span class="n">t1</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span>
       <span class="n">t1</span><span class="p">.</span><span class="n">ename</span><span class="p">,</span>
       <span class="n">t1</span><span class="p">.</span><span class="n">mgr</span><span class="p">,</span>
       <span class="n">t2</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
       <span class="n">t2</span><span class="p">.</span><span class="n">ename</span>
<span class="k">from</span> <span class="n">emp</span> <span class="n">t1</span>
<span class="k">left</span> <span class="k">join</span>  <span class="n">emp</span> <span class="n">t2</span>
<span class="k">on</span> <span class="n">t1</span><span class="p">.</span><span class="n">mgr</span> <span class="o">=</span> <span class="n">t2</span><span class="p">.</span><span class="n">id</span>
</code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="事务">事务</h2>
<h3 id="事务的基本介绍">事务的基本介绍</h3>
<p>概念：如果一个包含多个步骤的业务操作，被事务管理，那么这些操作要么同时成功，要么同时失败</p>
<p>操作：</p>
<ol>
<li>开启事务：start transaction</li>
<li>回滚：rollback</li>
<li>提交：commit</li>
</ol>
<p>注意：</p>
<p>Mysql数据库中事务默认自动提交</p>
<p>一条DML（增删改）语句会自动提交奥一次事务</p>
<p>事务提交的两种方式：</p>
<p>自动提交：mysql的默认方式</p>
<p>手动提交：需要先开启事务，再提交</p>
<p>查看事务的默认提交方式：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="o">@@</span><span class="n">autocommit</span><span class="p">;</span> <span class="c1">-- 1 表示自动提交，0表示手动提交
</span></code></pre></td></tr></table>
</div>
</div><p>如果想要更改：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span> <span class="o">@@</span><span class="n">autocommit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="事务的四大特征">事务的四大特征</h3>
<ul>
<li>原子性：是不可分割的最小单位，要么同时成功，要么同时失败</li>
<li>持久性：当事务提交或回滚后，数据会持久化的保存数据</li>
<li>隔离性： 多个事务之间。相互独立</li>
<li>一致性： 事务操作前后，数据总量不变</li>
</ul>
<h3 id="事务的隔离级别">事务的隔离级别</h3>
<p>概念：多个事务之间是相互隔离的，相互独立。但是多个事务操作同一批数据，会引发一些问题。设置不同的隔离级别就卡一解决这些问题</p>
<p>存在的问题：</p>
<ul>
<li>脏读：一个事务，读取到另外一个事务中没有提交的数据</li>
<li>不可重复读（虚读）：在同一个事务中，两次读取到的数据不一样</li>
<li>幻读：一个事务操作数据表中所有记录，另外一个事务添加了一条数据，则第一个事务查询不到自己的修改</li>
</ul>
<p>隔离级别：</p>
<ul>
<li>read umcommitted:读未提交。 会产生的问题：脏读，不可重复读，幻读</li>
<li>read commit:读已提交。会产生的问题：不可重复读，幻读</li>
<li>repeatable read: 可重复读。 会产生幻读 （Mysql默认级别）</li>
<li>serializable: 串行化。 可以解决所有的问题</li>
</ul>
<p>注意：隔离级别从小到大安全性越来越高，但是效率越来越低</p>
<p>数据库查询隔离级别：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="k">select</span> <span class="o">@@</span><span class="n">tx_isolation</span><span class="p">;</span>
</code></pre></td></tr></table>
</div>
</div><p>数据设置隔离级别：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mysql" data-lang="mysql"><span class="kt">set</span> <span class="n">global</span> <span class="n">transaction</span> <span class="n">isolation</span> <span class="n">level</span> <span class="err">级别字符串</span> 
</code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>本文于 2020-09-29 更新</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="http://example.org/mysql_note01/" data-title="mysql笔记--基础知识" data-hashtags="mysql"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="http://example.org/mysql_note01/" data-title="mysql笔记--基础知识"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/mysql">mysql</a></section>
        <section>
            <span><a href="javascript:window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/protocol_analysis_01/" class="prev" rel="prev" title="安全杂乱笔记整理1---常用服务端口总结"><i class="fas fa-angle-left fa-fw"></i>安全杂乱笔记整理1---常用服务端口总结</a>
            <a href="/redis_note1/" class="next" rel="next" title="Redis核心技术与实战笔记1-redis中的数据结构">Redis核心技术与实战笔记1-redis中的数据结构<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div class="comment"><div id="gitalk"></div><script>
            document.addEventListener("DOMContentLoaded", function(event) {
                var gitalk = new Gitalk({
                    id: '2020-09-29 19:40:56 \x2b0800 CST',
                    title: 'mysql笔记--基础知识',
                    clientID: '12d62df89f42baf9a471',
                    clientSecret: '603bc3951c1c2a0685201df45862a1fdb34a83f1',
                    repo: 'blogComment',
                    owner: 'peanut-cc',
                    admin: ['peanut-cc'],
                    body: decodeURI(location.href),
                });
                gitalk.render('gitalk');
            });
        </script>
        <noscript>
            Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by Gitalk.</a>
        </noscript></div>
    </article></div>
            </main><footer class="footer">
    <div class="copyright"><div class="copyright-line">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer"><i class="far fa-heart fa-fw"></i> LoveIt</a>
        </div>

        <div class="copyright-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="http://syncd.cn" target="_blank">zhaofan</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                <span class="icp">京ICP备17004069号-2</span></div>
    </div>
</footer>
</div><a href="#" class="dynamic-to-top animated faster" id="dynamic-to-top">
            <i class="fas fa-chevron-up fa-fw"></i>
        </a><script>
        document.addEventListener('DOMContentLoaded', function () {
            lightGallery(document.getElementById('content'), {
                selector: '.lightgallery',
                speed: 400,
                hideBarsDelay: 2000,
                thumbnail: true,
                exThumbImage: 'data-thumbnail',
                thumbWidth: 80,
                thumbContHeight: 80,
            });
        });
    </script><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script src="/lib/gitalk/gitalk.min.js"></script><script src="/lib/smooth-scroll/smooth-scroll.polyfills.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/lightgallery/lightgallery.min.js"></script><script src="/lib/lightgallery/lg-thumbnail.min.js"></script><script src="/lib/lightgallery/lg-zoom.min.js"></script><script src="/js/theme.min.js"></script></body>
</html>
