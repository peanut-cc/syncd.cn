<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>从别人的代码中学习golang系列--01 | FAN&#39;S BLOG</title>
        <meta name="Description" content="syncd blog, 在成为高级开发者的路上....."><meta property="og:title" content="从别人的代码中学习golang系列--01" />
<meta property="og:description" content="​ 自己最近在思考一个问题，如何让自己的代码质量逐渐提高，于是想到整理这个系列，通过阅读别人的代码，从别人的代码中学习，来逐渐提高自己的代码质" />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://example.org/study_code_01/" />
<meta property="article:published_time" content="2020-06-24T23:48:11+08:00" />
<meta property="article:modified_time" content="2020-06-24T23:48:11+08:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="从别人的代码中学习golang系列--01"/>
<meta name="twitter:description" content="​ 自己最近在思考一个问题，如何让自己的代码质量逐渐提高，于是想到整理这个系列，通过阅读别人的代码，从别人的代码中学习，来逐渐提高自己的代码质"/>
<meta name="theme-color" content="#ffffff">
<meta name="msapplication-TileColor" content="#da532c">
<link rel="canonical" href="http://example.org/study_code_01/" />
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="prev" href="http://example.org/reverse-linked-list/" /><link rel="next" href="http://example.org/study_code_02/" /><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"><link rel="stylesheet" href="/lib/animate/animate.min.css"><link rel="stylesheet" href="/css/style.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "从别人的代码中学习golang系列--01",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "http:\/\/example.org\/study_code_01\/"
        },"image": {
                "@type": "ImageObject",
                "url": "http:\/\/example.org\/cover.png",
                "width":  800 ,
                "height":  600 
            },"genre": "posts","keywords": "Go","wordcount":  6006 ,
        "url": "http:\/\/example.org\/study_code_01\/","datePublished": "2020-06-24","dateModified": "2020-06-24","publisher": {
                "@type": "Organization",
                "name": "赵凡",
                "logo": {
                "@type": "ImageObject",
                "url": "http:\/\/example.org\/logo.png",
                "width":  127 ,
                "height":  40 
                }
            },"author": {
                "@type": "Person",
                "name": "fan"
            },"description": ""
    }
    </script></head>
    <body><script>
            if (!window.localStorage || !window.localStorage.getItem('theme')) {window.isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;} else {
                window.isDark = (window.localStorage && window.localStorage.getItem('theme')) === 'dark';
            }
            window.isDark && document.body.classList.add('dark-theme');
        </script><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/">FAN&#39;S BLOG</a>
        </div>
        <div class="menu"><a class="menu-item" href="/posts/" rel="noopener noreffer">文章</a><a class="menu-item" href="/tags/" rel="noopener noreffer">标签</a><a class="menu-item" href="/categories/" rel="noopener noreffer">分类</a><a class="menu-item" href="/about/" rel="noopener noreffer">关于</a><span class="menu-item">|</span>
            <a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-wrapper">
        <div class="header-container">
            <div class="header-title">
                <a href="/">FAN&#39;S BLOG</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="" rel="noopener noreffer">文章</a><a class="menu-item" href="/tags/" title="" rel="noopener noreffer">标签</a><a class="menu-item" href="/categories/" title="" rel="noopener noreffer">分类</a><a class="menu-item" href="/about/" title="" rel="noopener noreffer">关于</a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>

<script>
    window.desktopHeaderMode = "fixed";
    window.mobileHeaderMode = "auto";
</script>
<main class="main">
                <div class="container"><article class="page single"><h1 class="single-title animated flipInX">从别人的代码中学习golang系列--01</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="http://syncd.cn" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw"></i>fan</a>
</span>&nbsp;
                    <span class="post-category">收录于<a href="/categories/go">
                                <i class="far fa-folder fa-fw"></i>Go
                            </a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i><time datetime=2020-06-24>2020-06-24</time>&nbsp;
                <i class="fas fa-pencil-alt fa-fw"></i>约 6006 字&nbsp;
                <i class="far fa-clock fa-fw"></i>预计阅读 12 分钟&nbsp;</div>
        </div><div class="toc" id="toc-auto">
                <h2 class="toc-title">目录</h2>
                <div class="toc-content" id="toc-content-auto"></div>
            </div>
            <div class="toc" id="toc-static">
                <details>
                    <summary>
                        <div class="toc-title">
                            <span>目录</span>
                            <span><i class="details icon fas fa-angle-down"></i></span>
                        </div>
                    </summary>
                    <div class="toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#项目目录规范">项目目录规范</a>
      <ul>
        <li><a href="#cmd">/cmd</a></li>
        <li><a href="#internal"><code>/internal</code></a></li>
        <li><a href="#pkg"><code>/pkg</code></a></li>
        <li><a href="#vendor"><code>/vendor</code></a></li>
        <li><a href="#api"><code>/api</code></a></li>
        <li><a href="#web"><code>/web</code></a></li>
        <li><a href="#configs"><code>/configs</code></a></li>
        <li><a href="#init"><code>/init</code></a></li>
        <li><a href="#scripts"><code>/scripts</code></a></li>
        <li><a href="#build"><code>/build</code></a></li>
        <li><a href="#deployments"><code>/deployments</code></a></li>
        <li><a href="#test"><code>/test</code></a></li>
        <li><a href="#docs"><code>/docs</code></a></li>
        <li><a href="#tools"><code>/tools</code></a></li>
        <li><a href="#examples"><code>/examples</code></a></li>
        <li><a href="#assets"><code>/assets</code></a></li>
      </ul>
    </li>
    <li><a href="#配置文件的加载">配置文件的加载</a>
      <ul>
        <li><a href="#栗子">栗子</a></li>
      </ul>
    </li>
    <li><a href="#日志库在项目的使用">日志库在项目的使用</a></li>
    <li><a href="#项目的优雅退出">项目的优雅退出</a></li>
    <li><a href="#golang的选项模式">Golang的选项模式</a>
      <ul>
        <li><a href="#栗子-1">栗子</a></li>
        <li><a href="#选项模式小结">选项模式小结</a></li>
      </ul>
    </li>
    <li><a href="#总结">总结</a></li>
    <li><a href="#延伸阅读">延伸阅读</a></li>
  </ul>
</nav></div>
                </details>
            </div><div class="content" id="content"><p>​		自己最近在思考一个问题，如何让自己的代码质量逐渐提高，于是想到整理这个系列，通过阅读别人的代码，从别人的代码中学习，来逐渐提高自己的代码质量。本篇是这个系列的第一篇，我也不知道自己会写多少篇，但是希望自己能坚持下去。</p>
<p>第一个自己学习的源码是：https://github.com/LyricTian/gin-admin</p>
<p>自己整理的代码地址：https://github.com/peanut-pg/gin_admin 这篇文章整理的时候只是为了跑起来整体的代码，对作者的代码进行精简。</p>
<p>这篇博客主要是阅读gin-admin的第一篇，整理了从代码项目目录到日志库使用中学习到的内容：</p>
<ol>
<li>
<p>项目目录规范</p>
</li>
<li>
<p>配置文件的加载</p>
</li>
<li>
<p><code>github.com/sirupsen/logrus</code> 日志库在项目的使用</p>
</li>
<li>
<p>项目的优雅退出</p>
</li>
<li>
<p>Golang的选项模式</p>
</li>
</ol>
<h2 id="项目目录规范">项目目录规范</h2>
<p>作者的项目目录还是非常规范的，应该也是按照https://github.com/golang-standards/project-layout 规范写的，这个规范虽然不是官方强制规范的，但是确实很多开源项目都在采用的，所以我们在生产中正式的项目都应该尽可能遵循这个目录规范标准进行代码的编写。关于这个目录的规范使用，自己会在后续实际使用中逐渐完善。</p>
<h3 id="cmd">/cmd</h3>
<p>main函数文件（比如 <code>/cmd/myapp.go</code>）目录，这个目录下面，每个文件在编译之后都会生成一个可执行的文件。</p>
<p>不要把很多的代码放到这个目录下面，这里面的代码尽可能简单。</p>
<h3 id="internal"><code>/internal</code></h3>
<p>应用程序的封装的代码。我们的应用程序代码应该放在 <code>/internal/app </code>目录中。而这些应用程序共享的代码可以放在 <code>/internal/pkg</code>目录中</p>
<h3 id="pkg"><code>/pkg</code></h3>
<p>一些通用的可以被其他项目所使用的代码，放到这个目录下面。</p>
<h3 id="vendor"><code>/vendor</code></h3>
<p>应用程序的依赖项，go mod vendor 命令可以创建vendor目录。</p>
<p><strong>Service Application Directories</strong></p>
<h3 id="api"><code>/api</code></h3>
<p>协议文件，<code>Swagger/thrift/protobuf</code> 等</p>
<p><strong>Web Application Directories</strong></p>
<h3 id="web"><code>/web</code></h3>
<p>web服务所需要的静态文件</p>
<p><strong>Common Application Directories</strong></p>
<h3 id="configs"><code>/configs</code></h3>
<p>配置文件目录</p>
<h3 id="init"><code>/init</code></h3>
<p>系统的初始化</p>
<h3 id="scripts"><code>/scripts</code></h3>
<p>用于执行各种构建，安装，分析等操作的脚本。</p>
<h3 id="build"><code>/build</code></h3>
<p>打包和持续集成</p>
<h3 id="deployments"><code>/deployments</code></h3>
<p>部署相关的配置文件和模板</p>
<h3 id="test"><code>/test</code></h3>
<p>其他测试目录，功能测试，性能测试等</p>
<p><strong>Other Directories</strong></p>
<h3 id="docs"><code>/docs</code></h3>
<p>设计和用户文档</p>
<h3 id="tools"><code>/tools</code></h3>
<p>常用的工具和脚本，可以引用 <code>/internal</code> 或者 <code>/pkg</code> 里面的库</p>
<h3 id="examples"><code>/examples</code></h3>
<p>应用程序或者公共库使用的一些例子</p>
<h3 id="assets"><code>/assets</code></h3>
<p>其他一些依赖的静态资源</p>
<h2 id="配置文件的加载">配置文件的加载</h2>
<p>作者的gin-admin 项目中配置文件加载库使用的是：github.com/koding/multiconfig</p>
<p>在这之前，听到使用最多的就是大名鼎鼎的viper ，但是相对于viper相对来说就比较轻便了，并且功能还是非常强大的。感兴趣的可以看看这篇文章：https://sfxpt.wordpress.com/2015/06/19/beyond-toml-the-gos-de-facto-config-file/</p>
<h3 id="栗子">栗子</h3>
<p>程序目录结构为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">configLoad
├── configLoad
├── config.toml
└── main.go

</code></pre></td></tr></table>
</div>
</div><p>通过一个简单的例子来看看multiconfig的使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>

	<span class="s">&#34;github.com/koding/multiconfig&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="p">(</span>
	<span class="c1">// Server holds supported types by the multiconfig package
</span><span class="c1"></span>	<span class="nx">Server</span> <span class="kd">struct</span> <span class="p">{</span>
		<span class="nx">Name</span>     <span class="kt">string</span>
		<span class="nx">Port</span>     <span class="kt">int</span> <span class="s">`default:&#34;6060&#34;`</span>
		<span class="nx">Enabled</span>  <span class="kt">bool</span>
		<span class="nx">Users</span>    <span class="p">[]</span><span class="kt">string</span>
		<span class="nx">Postgres</span> <span class="nx">Postgres</span>
	<span class="p">}</span>

	<span class="c1">// Postgres is here for embedded struct feature
</span><span class="c1"></span>	<span class="nx">Postgres</span> <span class="kd">struct</span> <span class="p">{</span>
		<span class="nx">Enabled</span>           <span class="kt">bool</span>
		<span class="nx">Port</span>              <span class="kt">int</span>
		<span class="nx">Hosts</span>             <span class="p">[]</span><span class="kt">string</span>
		<span class="nx">DBName</span>            <span class="kt">string</span>
		<span class="nx">AvailabilityRatio</span> <span class="kt">float64</span>
	<span class="p">}</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">m</span> <span class="o">:=</span> <span class="nx">multiconfig</span><span class="p">.</span><span class="nf">NewWithPath</span><span class="p">(</span><span class="s">&#34;config.toml&#34;</span><span class="p">)</span> <span class="c1">// supports TOML and JSON
</span><span class="c1"></span>
	<span class="c1">// Get an empty struct for your configuration
</span><span class="c1"></span>	<span class="nx">serverConf</span> <span class="o">:=</span> <span class="nb">new</span><span class="p">(</span><span class="nx">Server</span><span class="p">)</span>

	<span class="c1">// Populated the serverConf struct
</span><span class="c1"></span>	<span class="nx">m</span><span class="p">.</span><span class="nf">MustLoad</span><span class="p">(</span><span class="nx">serverConf</span><span class="p">)</span> <span class="c1">// Check for error
</span><span class="c1"></span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;After Loading: &#34;</span><span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%+v\n&#34;</span><span class="p">,</span> <span class="nx">serverConf</span><span class="p">)</span>

	<span class="k">if</span> <span class="nx">serverConf</span><span class="p">.</span><span class="nx">Enabled</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Enabled field is set to true&#34;</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;Enabled field is set to false&#34;</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>配置文件config.toml内容为：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-toml" data-lang="toml"><span class="nx">Name</span>              <span class="p">=</span> <span class="s2">&#34;koding&#34;</span>
<span class="nx">Enabled</span>           <span class="p">=</span> <span class="kc">false</span>
<span class="nx">Port</span>              <span class="p">=</span> <span class="mi">6066</span>
<span class="nx">Users</span>             <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;ankara&#34;</span><span class="p">,</span> <span class="s2">&#34;istanbul&#34;</span><span class="p">]</span>

<span class="p">[</span><span class="nx">Postgres</span><span class="p">]</span>
<span class="nx">Enabled</span>           <span class="p">=</span> <span class="kc">true</span>
<span class="nx">Port</span>              <span class="p">=</span> <span class="mi">5432</span>
<span class="nx">Hosts</span>             <span class="p">=</span> <span class="p">[</span><span class="s2">&#34;192.168.2.1&#34;</span><span class="p">,</span> <span class="s2">&#34;192.168.2.2&#34;</span><span class="p">,</span> <span class="s2">&#34;192.168.2.3&#34;</span><span class="p">]</span>
<span class="nx">AvailabilityRatio</span> <span class="p">=</span> <span class="mf">8.23</span>
</code></pre></td></tr></table>
</div>
</div><p>编译之后执行，效果如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash">➜  configLoad ./configLoad 
After Loading: 
<span class="p">&amp;</span><span class="o">{</span>Name:koding Port:6066 Enabled:false Users:<span class="o">[</span>ankara istanbul<span class="o">]</span> Postgres:<span class="o">{</span>Enabled:true Port:5432 Hosts:<span class="o">[</span>192.168.2.1 192.168.2.2 192.168.2.3<span class="o">]</span> DBName: AvailabilityRatio:8.23<span class="o">}}</span>
Enabled field is <span class="nb">set</span> to <span class="nb">false</span>
➜  configLoad ./configLoad -h
Usage of ./configLoad:
  -enabled
        Change value of Enabled. <span class="o">(</span>default <span class="nb">false</span><span class="o">)</span>
  -name
        Change value of Name. <span class="o">(</span>default koding<span class="o">)</span>
  -port
        Change value of Port. <span class="o">(</span>default 6066<span class="o">)</span>
  -postgres-availabilityratio
        Change value of Postgres-AvailabilityRatio. <span class="o">(</span>default 8.23<span class="o">)</span>
  -postgres-dbname
        Change value of Postgres-DBName.
  -postgres-enabled
        Change value of Postgres-Enabled. <span class="o">(</span>default <span class="nb">true</span><span class="o">)</span>
  -postgres-hosts
        Change value of Postgres-Hosts. <span class="o">(</span>default <span class="o">[</span>192.168.2.1 192.168.2.2 192.168.2.3<span class="o">])</span>
  -postgres-port
        Change value of Postgres-Port. <span class="o">(</span>default 5432<span class="o">)</span>
  -users
        Change value of Users. <span class="o">(</span>default <span class="o">[</span>ankara istanbul<span class="o">])</span>

Generated environment variables:
   SERVER_ENABLED
   SERVER_NAME
   SERVER_PORT
   SERVER_POSTGRES_AVAILABILITYRATIO
   SERVER_POSTGRES_DBNAME
   SERVER_POSTGRES_ENABLED
   SERVER_POSTGRES_HOSTS
   SERVER_POSTGRES_PORT
   SERVER_USERS

flag: <span class="nb">help</span> requested
➜  configLoad ./configLoad -name<span class="o">=</span><span class="nb">test</span>
After Loading: 
<span class="p">&amp;</span><span class="o">{</span>Name:test Port:6066 Enabled:false Users:<span class="o">[</span>ankara istanbul<span class="o">]</span> Postgres:<span class="o">{</span>Enabled:true Port:5432 Hosts:<span class="o">[</span>192.168.2.1 192.168.2.2 192.168.2.3<span class="o">]</span> DBName: AvailabilityRatio:8.23<span class="o">}}</span>
Enabled field is <span class="nb">set</span> to <span class="nb">false</span>
➜  configLoad <span class="nb">export</span> <span class="nv">SERVER_NAME</span><span class="o">=</span><span class="s2">&#34;test_env&#34;</span>
➜  configLoad ./configLoad                 
After Loading: 
<span class="p">&amp;</span><span class="o">{</span>Name:test_env Port:6066 Enabled:false Users:<span class="o">[</span>ankara istanbul<span class="o">]</span> Postgres:<span class="o">{</span>Enabled:true Port:5432 Hosts:<span class="o">[</span>192.168.2.1 192.168.2.2 192.168.2.3<span class="o">]</span> DBName: AvailabilityRatio:8.23<span class="o">}}</span>
Enabled field is <span class="nb">set</span> to <span class="nb">false</span>
</code></pre></td></tr></table>
</div>
</div><p>从上面的使用中，你能能够看到，虽然multiconfig 非常轻量，但是功能还是非常强大的，可以读配置文件，还可以通过环境变量，以及我们常用的命令行模式。</p>
<h2 id="日志库在项目的使用">日志库在项目的使用</h2>
<p>这个可能对很多初学者来说都是非常有用的，因为一个项目中，我们基础的就是要记录日志，golang有很多强大的日志库，如：作者的gin-admin 项目使用的<code>github.com/sirupsen/logrus</code>; 还有就是uber开源的<code>github.com/uber-go/zap</code>等等</p>
<p>这里主要学习一下作者是如何在项目中使用logrus，这篇文章对作者使用的进行了精简。当然只是去掉了关于gorm，以及mongo的hook的部分，如果你的项目中没有使用这些，其实也先不用关注这两个hook部分的代码，不影响使用，后续的系列文章也会对hook部分进行整理。</p>
<p>作者封装的logger库是在pkg/loggger目录中，我精简之后如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">logger</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;context&#34;</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;io&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;time&#34;</span>

	<span class="s">&#34;github.com/sirupsen/logrus&#34;</span>
<span class="p">)</span>

<span class="c1">// 定义键名
</span><span class="c1"></span><span class="kd">const</span> <span class="p">(</span>
	<span class="nx">TraceIDKey</span>      <span class="p">=</span> <span class="s">&#34;trace_id&#34;</span>
	<span class="nx">UserIDKey</span>       <span class="p">=</span> <span class="s">&#34;user_id&#34;</span>
	<span class="nx">SpanTitleKey</span>    <span class="p">=</span> <span class="s">&#34;span_title&#34;</span>
	<span class="nx">SpanFunctionKey</span> <span class="p">=</span> <span class="s">&#34;span_function&#34;</span>
	<span class="nx">VersionKey</span>      <span class="p">=</span> <span class="s">&#34;version&#34;</span>
	<span class="nx">StackKey</span>        <span class="p">=</span> <span class="s">&#34;stack&#34;</span>
<span class="p">)</span>

<span class="c1">// TraceIDFunc 定义获取跟踪ID的函数
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">TraceIDFunc</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">string</span>

<span class="kd">var</span> <span class="p">(</span>
	<span class="nx">version</span>     <span class="kt">string</span>
	<span class="nx">traceIDFunc</span> <span class="nx">TraceIDFunc</span>
	<span class="nx">pid</span>         <span class="p">=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getpid</span><span class="p">()</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">traceIDFunc</span> <span class="p">=</span> <span class="kd">func</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;trace-id-%d-%s&#34;</span><span class="p">,</span>
			<span class="nx">os</span><span class="p">.</span><span class="nf">Getpid</span><span class="p">(),</span>
			<span class="nx">time</span><span class="p">.</span><span class="nf">Now</span><span class="p">().</span><span class="nf">Format</span><span class="p">(</span><span class="s">&#34;2006.01.02.15.04.05.999999&#34;</span><span class="p">))</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Logger 定义日志别名
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Logger</span> <span class="p">=</span> <span class="nx">logrus</span><span class="p">.</span><span class="nx">Logger</span>

<span class="c1">// Hook 定义日志钩子别名
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Hook</span> <span class="p">=</span> <span class="nx">logrus</span><span class="p">.</span><span class="nx">Hook</span>

<span class="c1">// StandardLogger 获取标准日志
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">StandardLogger</span><span class="p">()</span> <span class="o">*</span><span class="nx">Logger</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">logrus</span><span class="p">.</span><span class="nf">StandardLogger</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// SetLevel设定日志级别
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">SetLevel</span><span class="p">(</span><span class="nx">level</span> <span class="kt">int</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">logrus</span><span class="p">.</span><span class="nf">SetLevel</span><span class="p">(</span><span class="nx">logrus</span><span class="p">.</span><span class="nf">Level</span><span class="p">(</span><span class="nx">level</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// SetFormatter 设定日志输出格式
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">SetFormatter</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">switch</span> <span class="nx">format</span> <span class="p">{</span>
	<span class="k">case</span> <span class="s">&#34;json&#34;</span><span class="p">:</span>
		<span class="nx">logrus</span><span class="p">.</span><span class="nf">SetFormatter</span><span class="p">(</span><span class="nb">new</span><span class="p">(</span><span class="nx">logrus</span><span class="p">.</span><span class="nx">JSONFormatter</span><span class="p">))</span>
	<span class="k">default</span><span class="p">:</span>
		<span class="nx">logrus</span><span class="p">.</span><span class="nf">SetFormatter</span><span class="p">(</span><span class="nb">new</span><span class="p">(</span><span class="nx">logrus</span><span class="p">.</span><span class="nx">TextFormatter</span><span class="p">))</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// SetOutput 设定日志输出
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">SetOutput</span><span class="p">(</span><span class="nx">out</span> <span class="nx">io</span><span class="p">.</span><span class="nx">Writer</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">logrus</span><span class="p">.</span><span class="nf">SetOutput</span><span class="p">(</span><span class="nx">out</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// SetVersion 设定版本
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">SetVersion</span><span class="p">(</span><span class="nx">v</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">version</span> <span class="p">=</span> <span class="nx">v</span>
<span class="p">}</span>

<span class="c1">// SetTraceIDFunc 设定追踪ID的处理函数
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">SetTraceIDFunc</span><span class="p">(</span><span class="nx">fn</span> <span class="nx">TraceIDFunc</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">traceIDFunc</span> <span class="p">=</span> <span class="nx">fn</span>
<span class="p">}</span>

<span class="c1">// AddHook 增加日志钩子
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">AddHook</span><span class="p">(</span><span class="nx">hook</span> <span class="nx">Hook</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">logrus</span><span class="p">.</span><span class="nf">AddHook</span><span class="p">(</span><span class="nx">hook</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="p">(</span>
	<span class="nx">traceIDKey</span> <span class="kd">struct</span><span class="p">{}</span>
	<span class="nx">userIDKey</span>  <span class="kd">struct</span><span class="p">{}</span>
<span class="p">)</span>

<span class="c1">// NewTraceIDContext 创建跟踪ID上下文
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">NewTraceIDContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">traceID</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nf">WithValue</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">traceIDKey</span><span class="p">{},</span> <span class="nx">traceID</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// FromTraceIDContext 从上下文中获取跟踪ID
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">FromTraceIDContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="nx">v</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Value</span><span class="p">(</span><span class="nx">traceIDKey</span><span class="p">{})</span>
	<span class="k">if</span> <span class="nx">v</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.(</span><span class="kt">string</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">s</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nf">traceIDFunc</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// NewUserIDContext 创建用户ID上下文
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">NewUserIDContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">userID</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">context</span><span class="p">.</span><span class="nf">WithValue</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">userIDKey</span><span class="p">{},</span> <span class="nx">userID</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// FromUserIDContext 从上下文中获取用户ID
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">FromUserIDContext</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">)</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="nx">v</span> <span class="o">:=</span> <span class="nx">ctx</span><span class="p">.</span><span class="nf">Value</span><span class="p">(</span><span class="nx">userIDKey</span><span class="p">{})</span>
	<span class="k">if</span> <span class="nx">v</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">s</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">v</span><span class="p">.(</span><span class="kt">string</span><span class="p">);</span> <span class="nx">ok</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">s</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="s">&#34;&#34;</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">spanOptions</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Title</span>    <span class="kt">string</span>
	<span class="nx">FuncName</span> <span class="kt">string</span>
<span class="p">}</span>

<span class="c1">// SpanOption 定义跟踪单元的数据项
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">SpanOption</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">spanOptions</span><span class="p">)</span>

<span class="c1">// SetSpanTitle 设置跟踪单元的标题
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">SetSpanTitle</span><span class="p">(</span><span class="nx">title</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">SpanOption</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">spanOptions</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">o</span><span class="p">.</span><span class="nx">Title</span> <span class="p">=</span> <span class="nx">title</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// SetSpanFuncName 设置跟踪单元的函数名
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">SetSpanFuncName</span><span class="p">(</span><span class="nx">funcName</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">SpanOption</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">spanOptions</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">o</span><span class="p">.</span><span class="nx">FuncName</span> <span class="p">=</span> <span class="nx">funcName</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// StartSpan 开始一个追踪单元
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">StartSpan</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">SpanOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">Entry</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">ctx</span> <span class="o">==</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">ctx</span> <span class="p">=</span> <span class="nx">context</span><span class="p">.</span><span class="nf">Background</span><span class="p">()</span>
	<span class="p">}</span>
	<span class="kd">var</span> <span class="nx">o</span> <span class="nx">spanOptions</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">opt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">opts</span> <span class="p">{</span>
		<span class="nf">opt</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">o</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">fields</span> <span class="o">:=</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span>
		<span class="nx">VersionKey</span><span class="p">:</span> <span class="nx">version</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">v</span> <span class="o">:=</span> <span class="nf">FromTraceIDContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span> <span class="nx">v</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
		<span class="nx">fields</span><span class="p">[</span><span class="nx">TraceIDKey</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">v</span> <span class="o">:=</span> <span class="nf">FromUserIDContext</span><span class="p">(</span><span class="nx">ctx</span><span class="p">);</span> <span class="nx">v</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
		<span class="nx">fields</span><span class="p">[</span><span class="nx">UserIDKey</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">v</span> <span class="o">:=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">Title</span><span class="p">;</span> <span class="nx">v</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
		<span class="nx">fields</span><span class="p">[</span><span class="nx">SpanTitleKey</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
	<span class="p">}</span>
	<span class="k">if</span> <span class="nx">v</span> <span class="o">:=</span> <span class="nx">o</span><span class="p">.</span><span class="nx">FuncName</span><span class="p">;</span> <span class="nx">v</span> <span class="o">!=</span> <span class="s">&#34;&#34;</span> <span class="p">{</span>
		<span class="nx">fields</span><span class="p">[</span><span class="nx">SpanFunctionKey</span><span class="p">]</span> <span class="p">=</span> <span class="nx">v</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nf">newEntry</span><span class="p">(</span><span class="nx">logrus</span><span class="p">.</span><span class="nf">WithFields</span><span class="p">(</span><span class="nx">fields</span><span class="p">))</span>

<span class="p">}</span>

<span class="c1">// Debugf 写入调试日志
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Debugf</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nf">StartSpan</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nf">Debugf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Infof 写入消息日志
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Infof</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nf">StartSpan</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nf">Infof</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Printf 写入消息日志
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Printf</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nf">StartSpan</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nf">Printf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Warnf 写入警告日志
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Warnf</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nf">StartSpan</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nf">Warnf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Errorf 写入错误日志
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Errorf</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nf">StartSpan</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Fatalf 写入重大错误日志
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">Fatalf</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nf">StartSpan</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nf">Fatalf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// ErrorStack 输出错误栈
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">ErrorStack</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">err</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="nf">StartSpan</span><span class="p">(</span><span class="nx">ctx</span><span class="p">).</span><span class="nf">WithField</span><span class="p">(</span><span class="nx">StackKey</span><span class="p">,</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%+v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)).</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nf">Error</span><span class="p">())</span>
<span class="p">}</span>

<span class="c1">// Entry 定义统一的日志写入方式
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Entry</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">entry</span> <span class="o">*</span><span class="nx">logrus</span><span class="p">.</span><span class="nx">Entry</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">newEntry</span><span class="p">(</span><span class="nx">entry</span> <span class="o">*</span><span class="nx">logrus</span><span class="p">.</span><span class="nx">Entry</span><span class="p">)</span> <span class="o">*</span><span class="nx">Entry</span> <span class="p">{</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">Entry</span><span class="p">{</span><span class="nx">entry</span><span class="p">:</span> <span class="nx">entry</span><span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Entry</span><span class="p">)</span> <span class="nf">checkAndDelete</span><span class="p">(</span><span class="nx">fields</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{},</span> <span class="nx">keys</span> <span class="o">...</span><span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">Entry</span> <span class="p">{</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">key</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">keys</span> <span class="p">{</span>
		<span class="nx">_</span><span class="p">,</span> <span class="nx">ok</span> <span class="o">:=</span> <span class="nx">fields</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>
		<span class="k">if</span> <span class="nx">ok</span> <span class="p">{</span>
			<span class="nb">delete</span><span class="p">(</span><span class="nx">fields</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nf">newEntry</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nf">WithFields</span><span class="p">(</span><span class="nx">fields</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// WithFields 结构化字段写入
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Entry</span><span class="p">)</span> <span class="nf">WithFields</span><span class="p">(</span><span class="nx">fields</span> <span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{})</span> <span class="o">*</span><span class="nx">Entry</span> <span class="p">{</span>
	<span class="nx">e</span><span class="p">.</span><span class="nf">checkAndDelete</span><span class="p">(</span><span class="nx">fields</span><span class="p">,</span>
		<span class="nx">TraceIDKey</span><span class="p">,</span>
		<span class="nx">SpanTitleKey</span><span class="p">,</span>
		<span class="nx">SpanFunctionKey</span><span class="p">,</span>
		<span class="nx">VersionKey</span><span class="p">)</span>
	<span class="k">return</span> <span class="nf">newEntry</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nf">WithFields</span><span class="p">(</span><span class="nx">fields</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// WithField 结构化字段写入
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Entry</span><span class="p">)</span> <span class="nf">WithField</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">value</span> <span class="kd">interface</span><span class="p">{})</span> <span class="o">*</span><span class="nx">Entry</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">e</span><span class="p">.</span><span class="nf">WithFields</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kd">interface</span><span class="p">{}{</span><span class="nx">key</span><span class="p">:</span> <span class="nx">value</span><span class="p">})</span>
<span class="p">}</span>

<span class="c1">// Fatalf 重大错误日志
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Entry</span><span class="p">)</span> <span class="nf">Fatalf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">e</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Errorf 错误日志
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Entry</span><span class="p">)</span> <span class="nf">Errorf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">e</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Warnf 警告日志
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Entry</span><span class="p">)</span> <span class="nf">Warnf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">e</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nf">Warnf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Infof 消息日志
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Entry</span><span class="p">)</span> <span class="nf">Infof</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">e</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nf">Infof</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Printf 消息日志
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Entry</span><span class="p">)</span> <span class="nf">Printf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">e</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Debugf 写入调试日志
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">e</span> <span class="o">*</span><span class="nx">Entry</span><span class="p">)</span> <span class="nf">Debugf</span><span class="p">(</span><span class="nx">format</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">args</span> <span class="o">...</span><span class="kd">interface</span><span class="p">{})</span> <span class="p">{</span>
	<span class="nx">e</span><span class="p">.</span><span class="nx">entry</span><span class="p">.</span><span class="nf">Debugf</span><span class="p">(</span><span class="nx">format</span><span class="p">,</span> <span class="nx">args</span><span class="o">...</span><span class="p">)</span>
<span class="p">}</span>

</code></pre></td></tr></table>
</div>
</div><p>通过<code>Logrus &amp; Context</code> 实现了统一的 TraceID/UserID 等关键字段的输出，从这里也可以看出来，作者这样封装非常也符合符合pkg目录的要求，我们可以很容易的在internal/app 目录中使用封装好的logger。接着就看一下如何使用，作者在internal/app 目录下通过logger.go 中的InitLogger进行日志的初始化，设置了日志的级别，日志的格式，以及日志输出文件。这样我们在internal/app的其他包文件中只需要导入pkg下的logger即可以进行日志的记录。</p>
<h2 id="项目的优雅退出">项目的优雅退出</h2>
<p>在这里不得不提的就是一个基础知识Linux信号signal,推荐看看https://blog.csdn.net/lixiaogang_theanswer/article/details/80301624</p>
<p>linux系统中signum.h中有对所有信号的宏定义，这里注意一下，我使用的是manjaro linux,我的这个文件路径是<code>/usr/include/bits/signum.h</code> 不同的linux系统可能略有差别，可以通过<code>find / -name signum.h</code> 查找确定</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c" data-lang="c"><span class="cp">#define SIGSTKFLT       16      </span><span class="cm">/* Stack fault (obsolete).  */</span><span class="cp">
</span><span class="cp">#define SIGPWR          30      </span><span class="cm">/* Power failure imminent.  */</span><span class="cp">
</span><span class="cp"></span>
<span class="cp">#undef  SIGBUS
</span><span class="cp">#define SIGBUS           7
</span><span class="cp">#undef  SIGUSR1
</span><span class="cp">#define SIGUSR1         10
</span><span class="cp">#undef  SIGUSR2
</span><span class="cp">#define SIGUSR2         12
</span><span class="cp">#undef  SIGCHLD
</span><span class="cp">#define SIGCHLD         17
</span><span class="cp">#undef  SIGCONT
</span><span class="cp">#define SIGCONT         18
</span><span class="cp">#undef  SIGSTOP
</span><span class="cp">#define SIGSTOP         19
</span><span class="cp">#undef  SIGTSTP
</span><span class="cp">#define SIGTSTP         20
</span><span class="cp">#undef  SIGURG
</span><span class="cp">#define SIGURG          23
</span><span class="cp">#undef  SIGPOLL
</span><span class="cp">#define SIGPOLL         29
</span><span class="cp">#undef  SIGSYS
</span><span class="cp">#define SIGSYS          31
</span><span class="cp"></span>
</code></pre></td></tr></table>
</div>
</div><p>在linux终端可以使用<code>kill -l</code> 查看所有的信号</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">➜  ~ <span class="nb">kill</span> -l
HUP INT QUIT ILL TRAP ABRT BUS FPE KILL USR1 SEGV USR2 PIPE ALRM TERM STKFLT CHLD CONT STOP TSTP TTIN TTOU URG XCPU XFSZ VTALRM PROF WINCH POLL PWR SYS
➜  ~ 

</code></pre></td></tr></table>
</div>
</div><p>信号说明：</p>
<table>
<thead>
<tr>
<th><strong>信号</strong></th>
<th align="center"><strong>起源</strong></th>
<th align="center"><strong>默认行为</strong></th>
<th align="center"><strong>含义</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>SIGHUP</td>
<td align="center">POSIX</td>
<td align="center">Term</td>
<td align="center">控制终端挂起</td>
</tr>
<tr>
<td>SIGINT</td>
<td align="center">ANSI</td>
<td align="center">Term</td>
<td align="center">键盘输入以终端进程（ctrl + C）</td>
</tr>
<tr>
<td>SIGQUIT</td>
<td align="center">POSIX</td>
<td align="center">Core</td>
<td align="center">键盘输入使进程退出（Ctrl + \）</td>
</tr>
<tr>
<td>SIGILL</td>
<td align="center">ANSI</td>
<td align="center">Core</td>
<td align="center">非法指令</td>
</tr>
<tr>
<td>SIGTRAP</td>
<td align="center">POSIX</td>
<td align="center">Core</td>
<td align="center">断点陷阱，用于调试</td>
</tr>
<tr>
<td>SIGABRT</td>
<td align="center">ANSI</td>
<td align="center">Core</td>
<td align="center">进程调用abort函数时生成该信号</td>
</tr>
<tr>
<td>SIGIOT</td>
<td align="center">4.2BSD</td>
<td align="center">Core</td>
<td align="center">和SIGABRT相同</td>
</tr>
<tr>
<td>SIGBUS</td>
<td align="center">4.2BSD</td>
<td align="center">Core</td>
<td align="center">总线错误，错误内存访问</td>
</tr>
<tr>
<td>SIGFPE</td>
<td align="center">ANSI</td>
<td align="center">Core</td>
<td align="center">浮点异常</td>
</tr>
<tr>
<td>SIGKILL</td>
<td align="center">POSIX</td>
<td align="center">Term</td>
<td align="center">终止一个进程。该信号不可被捕获或被忽略</td>
</tr>
<tr>
<td>SIGUSR1</td>
<td align="center">POSIX</td>
<td align="center">Term</td>
<td align="center">用户自定义信号之一</td>
</tr>
<tr>
<td>SIGSEGV</td>
<td align="center">ANSI</td>
<td align="center">Core</td>
<td align="center">非法内存段使用</td>
</tr>
<tr>
<td>SIGUSR2</td>
<td align="center">POSIX</td>
<td align="center">Term</td>
<td align="center">用户自定义信号二</td>
</tr>
<tr>
<td>SIGPIPE</td>
<td align="center">POSIX</td>
<td align="center">Term</td>
<td align="center">往读端关闭的管道或socket链接中写数据</td>
</tr>
<tr>
<td>SIGALRM</td>
<td align="center">POSIX</td>
<td align="center">Term</td>
<td align="center">由alarm或settimer设置的实时闹钟超时引起</td>
</tr>
<tr>
<td>SIGTERM</td>
<td align="center">ANSI</td>
<td align="center">Term</td>
<td align="center">终止进程。kill命令默认发生的信号就是SIGTERM</td>
</tr>
<tr>
<td>SIGSTKFLT</td>
<td align="center">Linux</td>
<td align="center">Term</td>
<td align="center">早期的Linux使用该信号来报告数学协处理器栈错误</td>
</tr>
<tr>
<td>SIGCLD</td>
<td align="center">System V</td>
<td align="center">Ign</td>
<td align="center">和SIGCHLD相同</td>
</tr>
<tr>
<td>SIGCHLD</td>
<td align="center">POSIX</td>
<td align="center">Ign</td>
<td align="center">子进程状态发生变化（退出或暂停）</td>
</tr>
<tr>
<td>SIGCONT</td>
<td align="center">POSIX</td>
<td align="center">Cont</td>
<td align="center">启动被暂停的进程（Ctrl+Q）。如果目标进程未处于暂停状态，则信号被忽略</td>
</tr>
<tr>
<td>SIGSTOP</td>
<td align="center">POSIX</td>
<td align="center">Stop</td>
<td align="center">暂停进程（Ctrl+S）。该信号不可被捕捉或被忽略</td>
</tr>
<tr>
<td>SIGTSTP</td>
<td align="center">POSIX</td>
<td align="center">Stop</td>
<td align="center">挂起进程（Ctrl+Z）</td>
</tr>
<tr>
<td>SIGTTIN</td>
<td align="center">POSIX</td>
<td align="center">Stop</td>
<td align="center">后台进程试图从终端读取输入</td>
</tr>
<tr>
<td>SIGTTOU</td>
<td align="center">POSIX</td>
<td align="center">Stop</td>
<td align="center">后台进程试图往终端输出内容</td>
</tr>
<tr>
<td>SIGURG</td>
<td align="center">4.3 BSD</td>
<td align="center">Ign</td>
<td align="center">socket连接上接收到紧急数据</td>
</tr>
<tr>
<td>SIGXCPU</td>
<td align="center">4.2 BSD</td>
<td align="center">Core</td>
<td align="center">进程的CPU使用时间超过其软限制</td>
</tr>
<tr>
<td>SIGXFSZ</td>
<td align="center">4.2 BSD</td>
<td align="center">Core</td>
<td align="center">文件尺寸超过其软限制</td>
</tr>
<tr>
<td>SIGVTALRM</td>
<td align="center">4.2 BSD</td>
<td align="center">Termhttps://github.com/LyricTian/gin-admin</td>
<td align="center">与SIGALRM类似，不过它只统计本进程用户空间代码的运行时间</td>
</tr>
<tr>
<td>SIGPROF</td>
<td align="center">4.2 BSD</td>
<td align="center">Term</td>
<td align="center">与SIGALRM 类似，它同时统计用户代码和内核的运行时间</td>
</tr>
<tr>
<td>SIGWINCH</td>
<td align="center">4.3 BSD</td>
<td align="center">Ign</td>
<td align="center">终端窗口大小发生变化</td>
</tr>
<tr>
<td>SIGPOLL</td>
<td align="center">System V</td>
<td align="center">Term</td>
<td align="center">与SIGIO类似</td>
</tr>
<tr>
<td>SIGIO</td>
<td align="center">4.2 BSD</td>
<td align="center">Term</td>
<td align="center">IO就绪，比如socket上发生可读、可写事件。因为TCP服务器可触发SIGIO的条件很多，故而SIGIO无法在TCP服务器中用。SIGIO信号可用在UDP服务器中，但也很少见</td>
</tr>
<tr>
<td>SIGPWR</td>
<td align="center">System V</td>
<td align="center">Thttps://github.com/LyricTian/gin-adminerm</td>
<td align="center">对于UPS的系统，当电池电量过低时，SIGPWR信号被触发</td>
</tr>
<tr>
<td>SIGSYS</td>
<td align="center">POSIX</td>
<td align="center">Core</td>
<td align="center">非法系统调用</td>
</tr>
<tr>
<td>SIGUNUSED</td>
<td align="center"></td>
<td align="center">Core</td>
<td align="center">保留，通常和SIGSYS效果相同</td>
</tr>
</tbody>
</table>
<p>作者中代码是这样写的：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">Run</span><span class="p">(</span><span class="nx">ctx</span> <span class="nx">context</span><span class="p">.</span><span class="nx">Context</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">Option</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">state</span> <span class="kt">int32</span> <span class="p">=</span> <span class="mi">1</span>
	<span class="nx">sc</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="nx">signal</span><span class="p">.</span><span class="nf">Notify</span><span class="p">(</span><span class="nx">sc</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGHUP</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGTERM</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGQUIT</span><span class="p">)</span>
	<span class="nx">cleanFunc</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">Init</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="nx">opts</span><span class="o">...</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">err</span>
	<span class="p">}</span>

<span class="nx">EXIT</span><span class="p">:</span>
	<span class="k">for</span> <span class="p">{</span>
		<span class="nx">sig</span> <span class="o">:=</span> <span class="o">&lt;-</span><span class="nx">sc</span>
		<span class="nx">logger</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;接收到信号[%s]&#34;</span><span class="p">,</span> <span class="nx">sig</span><span class="p">.</span><span class="nf">String</span><span class="p">())</span>
		<span class="k">switch</span> <span class="nx">sig</span> <span class="p">{</span>
		<span class="k">case</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGQUIT</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGTERM</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGINT</span><span class="p">:</span>
			<span class="nx">atomic</span><span class="p">.</span><span class="nf">CompareAndSwapInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">state</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
			<span class="k">break</span> <span class="nx">EXIT</span>
		<span class="k">case</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGHUP</span><span class="p">:</span>
		<span class="k">default</span><span class="p">:</span>
			<span class="k">break</span> <span class="nx">EXIT</span>
		<span class="p">}</span>
	<span class="p">}</span>
    <span class="c1">// 进行一些清理操作
</span><span class="c1"></span>	<span class="nf">cleanFunc</span><span class="p">()</span>
	<span class="nx">logger</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="nx">ctx</span><span class="p">,</span> <span class="s">&#34;服务退出&#34;</span><span class="p">)</span>
	<span class="nx">time</span><span class="p">.</span><span class="nf">Sleep</span><span class="p">(</span><span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span>
	<span class="nx">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nx">atomic</span><span class="p">.</span><span class="nf">LoadInt32</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">state</span><span class="p">)))</span>
	<span class="k">return</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这里监听了syscall.SIGHUP, syscall.SIGINT, syscall.SIGTERM, syscall.SIGQUIT，当收到这些信号的，则会进行系统的退出，同时在程序退出之前进行一些清理操作。</p>
<p>这里我们有一个知识点需要回顾一下：golang中的break label 和 goto label</p>
<ul>
<li>break label,break的跳转标签(label)必须放在循环语句for前面，并且在break label跳出循环不再执行for循环里的代码。break标签只能用于for循环</li>
<li>goto label的label(标签)既可以定义在for循环前面,也可以定义在for循环后面，当跳转到标签地方时，继续执行标签下面的代码。</li>
</ul>
<h2 id="golang的选项模式">Golang的选项模式</h2>
<p>其实在很多的开源项目中都可以看到golang 选项模式的使用，推荐看看https://www.sohamkamani.com/golang/options-pattern/</p>
<p>假如我们现在想要建造一个房子，我们思考，建造房子需要木材，水泥&hellip;&hellip;，假如我们现在就想到这两个，我们用代码实现：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">House</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">wood</span>   <span class="kt">string</span> <span class="c1">// 木材
</span><span class="c1"></span>	<span class="nx">cement</span> <span class="kt">string</span> <span class="c1">// 水泥
</span><span class="c1"></span><span class="p">}</span>

<span class="c1">// 造一个房子
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">NewHouse</span><span class="p">(</span><span class="nx">wood</span><span class="p">,</span> <span class="nx">cement</span> <span class="nx">shttps</span><span class="p">:</span><span class="c1">//github.com/LyricTian/gin-admintring) *House {
</span><span class="c1"></span>	<span class="nx">house</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">House</span><span class="p">{</span>
		<span class="nx">wood</span><span class="p">:</span>   <span class="nx">wood</span><span class="p">,</span>
		<span class="nx">cement</span><span class="p">:</span> <span class="nx">cement</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">house</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>上面这种方式，应该是我们经常可以看到的实现方式，但是这样实现有一个很不好的地方，就是我们突然发现我们建造房子海需要钢筋，这个时候我们就必须更改NewHouse 函数的参数，并且NewHouse的参数还有顺序依赖。</p>
<p>对于扩展性来说，上面的这种实现放那格式其实不是非常好，而golang的选项模式很好的解决了这个问题。</p>
<h3 id="栗子-1">栗子</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">HouseOption</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">House</span><span class="p">)</span>

<span class="kd">type</span> <span class="nx">House</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Wood</span>   <span class="kt">string</span> <span class="c1">// 木材
</span><span class="c1"></span>	<span class="nx">Cement</span> <span class="kt">string</span> <span class="c1">// 水泥
</span><span class="c1"></span><span class="p">}</span>

<span class="kd">func</span> <span class="nf">WithWood</span><span class="p">(</span><span class="nx">wood</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">HouseOption</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">house</span> <span class="o">*</span><span class="nx">House</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">house</span><span class="p">.</span><span class="nx">Wood</span> <span class="p">=</span> <span class="nx">wood</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">WithCement</span><span class="p">(</span><span class="nx">Cement</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">HouseOption</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">house</span> <span class="o">*</span><span class="nx">House</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">house</span><span class="p">.</span><span class="nx">Cement</span> <span class="p">=</span> <span class="nx">Cement</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 造一个新房子
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">NewHouse</span><span class="p">(</span><span class="nx">opts</span> <span class="o">...</span><span class="nx">HouseOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">House</span> <span class="p">{</span>
	<span class="nx">h</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">House</span><span class="p">{}</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">opt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">opts</span> <span class="p">{</span>
		<span class="nf">opt</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">h</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>这样当我们这个时候发现，我建造房子还需要石头，只需要在House结构体中增加对应的字段，同时增加一个</p>
<p><code>WithStone</code> 函数即可，同时我们我们调用NewHouse的地方也不会有顺序依赖，只需要增加一个参数即可，更改之后的代码如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">HouseOption</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">House</span><span class="p">)</span>

<span class="kd">type</span> <span class="nx">House</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">Wood</span>   <span class="kt">string</span> <span class="c1">// 木材
</span><span class="c1"></span>	<span class="nx">Cement</span> <span class="kt">string</span> <span class="c1">// 水泥
</span><span class="c1"></span>	<span class="nx">Stone</span>  <span class="kt">string</span> <span class="c1">// 石头
</span><span class="c1"></span><span class="p">}</span>

<span class="kd">func</span> <span class="nf">WithWood</span><span class="p">(</span><span class="nx">wood</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">HouseOption</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">house</span> <span class="o">*</span><span class="nx">House</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">house</span><span class="p">.</span><span class="nx">Wood</span> <span class="p">=</span> <span class="nx">wood</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">WithCement</span><span class="p">(</span><span class="nx">Cement</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">HouseOption</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">house</span> <span class="o">*</span><span class="nx">House</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">house</span><span class="p">.</span><span class="nx">Cement</span> <span class="p">=</span> <span class="nx">Cement</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">WithStone</span><span class="p">(</span><span class="nx">stone</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">HouseOption</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">house</span> <span class="o">*</span><span class="nx">House</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">house</span><span class="p">.</span><span class="nx">Stone</span> <span class="p">=</span> <span class="nx">stone</span>
	<span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 造一个新房子
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">NewHouse</span><span class="p">(</span><span class="nx">opts</span> <span class="o">...</span><span class="nx">HouseOption</span><span class="p">)</span> <span class="o">*</span><span class="nx">House</span> <span class="p">{</span>
	<span class="nx">h</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">House</span><span class="p">{}</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">opt</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">opts</span> <span class="p">{</span>
		<span class="nf">opt</span><span class="p">(</span><span class="nx">h</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">h</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">house</span> <span class="o">:=</span> <span class="nf">NewHouse</span><span class="p">(</span>
		<span class="nf">WithCement</span><span class="p">(</span><span class="s">&#34;上好的水泥&#34;</span><span class="p">),</span>
		<span class="nf">WithWood</span><span class="p">(</span><span class="s">&#34;上好的木材&#34;</span><span class="p">),</span>
		<span class="nf">WithStone</span><span class="p">(</span><span class="s">&#34;上好的石头&#34;</span><span class="p">),</span>
	<span class="p">)</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="nx">house</span><span class="p">)</span><span class="nx">https</span><span class="p">:</span><span class="c1">//github.com/LyricTian/gin-admin
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h3 id="选项模式小结">选项模式小结</h3>
<ul>
<li>生产中正式的并且较大的项目使用选项模式可以方便后续的扩展</li>
<li>增加了代码量，但让参数的传递更新清晰明了</li>
<li>在参数确实比较复杂的场景推荐使用选项模式</li>
</ul>
<h2 id="总结">总结</h2>
<p>从https://github.com/LyricTian/gin-admin 作者的这个项目中我们首先从大的方面学习了：</p>
<ol>
<li>golang 项目的目录规范</li>
<li>github.com/koding/multiconfig 配置文件库</li>
<li>logrus 日志库的使用</li>
<li>项目的优雅退出实现，信号相关知识</li>
<li>golang的选项模式</li>
</ol>
<p>对于我自己来说，对于之后写golang项目，通过上面这些知识点，可以很快速的取构建一个项目的基础部分，也希望看到这篇文章能够帮到你，如果有写的不对的地方，也欢迎评论指出。</p>
<h2 id="延伸阅读">延伸阅读</h2>
<ul>
<li><a href="https://github.com/LyricTian/gin-admin">https://github.com/LyricTian/gin-admin</a></li>
<li><a href="https://github.com/golang-standards/project-layout">https://github.com/golang-standards/project-layout</a></li>
<li><a href="https://sfxpt.wordpress.com/2015/06/19/beyond-toml-the-gos-de-facto-config-file/">https://sfxpt.wordpress.com/2015/06/19/beyond-toml-the-gos-de-facto-config-file/</a></li>
<li><a href="https://github.com/koding/multiconfig">https://github.com/koding/multiconfig</a></li>
<li><a href="https://github.com/sirupsen/logrus">https://github.com/sirupsen/logrus</a></li>
<li><a href="https://blog.csdn.net/lixiaogang_theanswer/article/details/80301624">https://blog.csdn.net/lixiaogang_theanswer/article/details/80301624</a></li>
<li><a href="https://www.sohamkamani.com/golang/options-pattern/">https://www.sohamkamani.com/golang/options-pattern/</a></li>
</ul>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>本文于 2020-06-24 更新</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 Twitter" data-sharer="twitter" data-url="http://example.org/study_code_01/" data-title="从别人的代码中学习golang系列--01" data-hashtags="Go"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="分享到 Evernote" data-sharer="evernote" data-url="http://example.org/study_code_01/" data-title="从别人的代码中学习golang系列--01"><i class="fab fa-evernote fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/go">Go</a></section>
        <section>
            <span><a href="javascript:window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/reverse-linked-list/" class="prev" rel="prev" title="算法练习-Reverse-Linked-List"><i class="fas fa-angle-left fa-fw"></i>算法练习-Reverse-Linked-List</a>
            <a href="/study_code_02/" class="next" rel="next" title="从别人的代码中学习golang系列--02">从别人的代码中学习golang系列--02<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div class="comment"><div id="gitalk"></div><script>
            document.addEventListener("DOMContentLoaded", function(event) {
                var gitalk = new Gitalk({
                    id: '2020-06-24 23:48:11 \u002b0800 CST',
                    title: '从别人的代码中学习golang系列--01',
                    clientID: '12d62df89f42baf9a471',
                    clientSecret: '603bc3951c1c2a0685201df45862a1fdb34a83f1',
                    repo: 'blogComment',
                    owner: 'peanut-cc',
                    admin: ['peanut-cc'],
                    body: decodeURI(location.href),
                });
                gitalk.render('gitalk');
            });
        </script>
        <noscript>
            Please enable JavaScript to view the <a href="https://github.com/gitalk/gitalk">comments powered by Gitalk.</a>
        </noscript></div>
    </article></div>
            </main><footer class="footer">
    <div class="copyright"><div class="copyright-line">由 <a href="https://gohugo.io/" target="_blank" rel="external nofollow noopener noreffer">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="external nofollow noopener noreffer"><i class="far fa-heart fa-fw"></i> LoveIt</a>
        </div>

        <div class="copyright-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2020</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="http://syncd.cn" target="_blank">zhaofan</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span><span class="icp-splitter">&nbsp;|&nbsp;</span><br class="icp-br"/>
                <span class="icp">京ICP备17004069号-2</span></div>
    </div>
</footer>
</div><a href="#" class="dynamic-to-top animated faster" id="dynamic-to-top">
            <i class="fas fa-chevron-up fa-fw"></i>
        </a><script>
        document.addEventListener('DOMContentLoaded', function () {
            lightGallery(document.getElementById('content'), {
                selector: '.lightgallery',
                speed: 400,
                hideBarsDelay: 2000,
                thumbnail: true,
                exThumbImage: 'data-thumbnail',
                thumbWidth: 80,
                thumbContHeight: 80,
            });
        });
    </script><link rel="stylesheet" href="/lib/gitalk/gitalk.min.css"><link rel="stylesheet" href="/lib/lightgallery/lightgallery.min.css"><script src="/lib/gitalk/gitalk.min.js"></script><script src="/lib/smooth-scroll/smooth-scroll.polyfills.min.js"></script><script src="/lib/sharer/sharer.min.js"></script><script src="/lib/lazysizes/lazysizes.min.js"></script><script src="/lib/lightgallery/lightgallery.min.js"></script><script src="/lib/lightgallery/lg-thumbnail.min.js"></script><script src="/lib/lightgallery/lg-zoom.min.js"></script><script src="/js/theme.min.js"></script></body>
</html>
